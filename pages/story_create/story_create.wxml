<!-- story_create.wxml - åˆ›ä½œå…¥å£é¡µ -->
<view class="container">
  <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
  <view class="step-indicator">
    <view class="step {{currentStep >= 1 ? 'active' : ''}}">1</view>
    <view class="step-line {{currentStep >= 2 ? 'active' : ''}}"></view>
    <view class="step {{currentStep >= 2 ? 'active' : ''}}">2</view>
    <view class="step-line {{currentStep >= 3 ? 'active' : ''}}"></view>
    <view class="step {{currentStep >= 3 ? 'active' : ''}}">3</view>
  </view>

  <!-- Step 1: é€‰æ‹©è¡¨è¾¾æ„å›¾ -->
  <view class="step-content" wx:if="{{currentStep === 1}}">
    <view class="section-title">æˆ‘æƒ³è¡¨è¾¾ä»€ä¹ˆï¼Ÿ</view>
    <view class="intent-list">
      <view 
        class="intent-card {{selectedIntent === item.key ? 'selected' : ''}}"
        wx:for="{{intents}}"
        wx:key="key"
        bindtap="selectIntent"
        data-key="{{item.key}}"
        data-panels="{{item.panels}}"
      >
        <view class="intent-icon">{{item.icon}}</view>
        <view class="intent-info">
          <view class="intent-title">{{item.title}}</view>
          <view class="intent-desc">{{item.desc}}</view>
        </view>
        <view class="intent-badge" wx:if="{{item.recommended}}">æ¨è</view>
      </view>
    </view>
  </view>

  <!-- Step 2: é€‰æ‹©é£æ ¼ + æ ¼æ•°å¸ƒå±€ -->
  <view class="step-content" wx:if="{{currentStep === 2}}">
    <view class="section-title">é€‰æ‹©é£æ ¼</view>
    <scroll-view scroll-x class="style-scroll">
      <view class="style-list">
        <view 
          class="style-card {{selectedStyle === item.key ? 'selected' : ''}}"
          wx:for="{{styles}}"
          wx:key="key"
          bindtap="selectStyle"
          data-key="{{item.key}}"
        >
          <image class="style-image" src="{{item.cover}}" mode="aspectFill"></image>
          <view class="style-name">{{item.name}}</view>
          <view class="style-check" wx:if="{{selectedStyle === item.key}}">âœ“</view>
        </view>
      </view>
    </scroll-view>

    <!-- æ ¼æ•°å¸ƒå±€é€‰æ‹© -->
    <view class="panel-section">
      <view class="section-subtitle">é€‰æ‹©æ ¼æ•°</view>
      <view class="panel-tip">ğŸ’¡ é€‚åˆå‘æœ‹å‹åœˆ</view>
      <view class="panel-list">
        <view 
          class="panel-card {{selectedPanels === item.count ? 'selected' : ''}}"
          wx:for="{{panelLayouts}}"
          wx:key="count"
          bindtap="selectPanels"
          data-count="{{item.count}}"
        >
          <view class="panel-icon">{{item.icon}}</view>
          <view class="panel-name">{{item.name}}</view>
          <view class="panel-badge" wx:if="{{item.recommended}}">æ¨è</view>
        </view>
      </view>
    </view>

    <!-- å¯é€‰ï¼šä¸Šä¼ ç…§ç‰‡ -->
    <view class="photo-section">
      <view class="section-subtitle">ä¸Šä¼ ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰</view>
      <view class="photo-tip">ğŸ’¡ è®©ä¸»è§’æ›´åƒä½ </view>
      <view class="photo-upload" bindtap="choosePhoto">
        <image wx:if="{{photoPath}}" class="photo-preview" src="{{photoPath}}" mode="aspectFill"></image>
        <view wx:else class="photo-placeholder">
          <view class="photo-icon">ğŸ“·</view>
          <view class="photo-text">ç‚¹å‡»ä¸Šä¼ </view>
        </view>
        <view class="photo-remove" wx:if="{{photoPath}}" catchtap="removePhoto">Ã—</view>
      </view>
    </view>
  </view>

  <!-- Step 3: ç¡®è®¤ç”Ÿæˆ -->
  <view class="step-content" wx:if="{{currentStep === 3}}">
    <view class="section-title">ç¡®è®¤ä¿¡æ¯</view>
    <view class="confirm-card">
      <view class="confirm-row">
        <text class="confirm-label">è¡¨è¾¾æ„å›¾</text>
        <text class="confirm-value">{{selectedIntentText}}</text>
      </view>
      <view class="confirm-row">
        <text class="confirm-label">é£æ ¼</text>
        <text class="confirm-value">{{selectedStyleText}}</text>
      </view>
      <view class="confirm-row">
        <text class="confirm-label">æ ¼æ•°</text>
        <text class="confirm-value">{{selectedPanels}}æ ¼</text>
      </view>
      <view class="confirm-row">
        <text class="confirm-label">ç…§ç‰‡</text>
        <text class="confirm-value">{{photoPath ? 'å·²ä¸Šä¼ ' : 'ä½¿ç”¨é»˜è®¤è§’è‰²'}}</text>
      </view>
      <view class="confirm-row" wx:if="{{locationName}}">
        <text class="confirm-label">ä½ç½®</text>
        <text class="confirm-value">ğŸ“ {{locationName}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’®åŒº -->
  <view class="bottom-actions">
    <view class="btn-secondary" wx:if="{{currentStep > 1}}" bindtap="prevStep">ä¸Šä¸€æ­¥</view>
    <view class="btn-primary" bindtap="nextStep" wx:if="{{currentStep < 3}}">
      ä¸‹ä¸€æ­¥
    </view>
    <view class="btn-primary generate" bindtap="startGenerate" wx:if="{{currentStep === 3}}">
      <text wx:if="{{!isGenerating}}">âœ¨ ç”Ÿæˆ {{selectedPanels}} æ ¼æ•…äº‹å›¾</text>
      <text wx:else>ç”Ÿæˆä¸­...</text>
    </view>
  </view>
</view>

<!-- ç”Ÿæˆä¸­é®ç½© -->
<view class="loading-mask" wx:if="{{isGenerating}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <view class="loading-text">æ­£åœ¨ç”Ÿæˆä½ çš„ {{selectedPanels}} æ ¼æ•…äº‹å›¾...</view>
    <view class="loading-tip">å¤§çº¦éœ€è¦ {{selectedPanels * 5}}-{{selectedPanels * 10}} ç§’</view>
  </view>
</view>
