import{an as Z,aA as ee,r as i,ao as ne,az as S,aL as re,f as V,al as v,cG as oe,j as f,aq as le,aM as O,aN as g}from"./index-BTXTJVKt.js";import{o as te,H as ae}from"./BaseForm-Bt-x2uS5.js";import{M as ie}from"./index-JJDTxIwy.js";var se=["children","trigger","onVisibleChange","onOpenChange","modalProps","onFinish","submitTimeout","title","width","visible","open"];function fe(s){var m,p,D=s.children,h=s.trigger,_=s.onVisibleChange,$=s.onOpenChange,e=s.modalProps,k=s.onFinish,C=s.submitTimeout,H=s.title,A=s.width,T=s.visible,P=s.open,a=Z(s,se);ee(!a.footer||!(e!=null&&e.footer),"ModalForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var R=i.useContext(ne.ConfigContext),B=i.useState([]),G=S(B,2),L=G[1],q=i.useState(!1),E=S(q,2),y=E[0],w=E[1],z=re(!!T,{value:P||T,onChange:$||_}),I=S(z,2),M=I[0],d=I[1],F=i.useRef(null),N=i.useCallback(function(o){F.current===null&&o&&L([]),F.current=o},[]),b=i.useRef(),U=i.useCallback(function(){var o,n,r,t=(o=(n=a.form)!==null&&n!==void 0?n:(r=a.formRef)===null||r===void 0?void 0:r.current)!==null&&o!==void 0?o:b.current;t&&e!==null&&e!==void 0&&e.destroyOnClose&&t.resetFields()},[e==null?void 0:e.destroyOnClose,a.form,a.formRef]);i.useImperativeHandle(a.formRef,function(){return b.current},[b.current]),i.useEffect(function(){(P||T)&&($==null||$(!0),_==null||_(!0))},[T,P]);var W=i.useMemo(function(){return h?V.cloneElement(h,v(v({key:"trigger"},h.props),{},{onClick:function(){var o=O(g().mark(function r(t){var u,l;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d(!M),(u=h.props)===null||u===void 0||(l=u.onClick)===null||l===void 0||l.call(u,t);case 2:case"end":return c.stop()}},r)}));function n(r){return o.apply(this,arguments)}return n}()})):null},[d,h,M]),J=i.useMemo(function(){var o,n,r,t,u,l,x;return a.submitter===!1?!1:oe({searchConfig:{submitText:(o=(n=e==null?void 0:e.okText)!==null&&n!==void 0?n:(r=R.locale)===null||r===void 0||(r=r.Modal)===null||r===void 0?void 0:r.okText)!==null&&o!==void 0?o:"确认",resetText:(t=(u=e==null?void 0:e.cancelText)!==null&&u!==void 0?u:(l=R.locale)===null||l===void 0||(l=l.Modal)===null||l===void 0?void 0:l.cancelText)!==null&&t!==void 0?t:"取消"},resetButtonProps:{preventDefault:!0,disabled:C?y:void 0,onClick:function(Y){var j;d(!1),e==null||(j=e.onCancel)===null||j===void 0||j.call(e,Y)}}},(x=a.submitter)!==null&&x!==void 0?x:{})},[(m=R.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.cancelText,(p=R.locale)===null||p===void 0||(p=p.Modal)===null||p===void 0?void 0:p.okText,e,a.submitter,d,y,C]),K=i.useCallback(function(o,n){return f.jsxs(f.Fragment,{children:[o,F.current&&n?f.jsx(V.Fragment,{children:le.createPortal(n,F.current)},"submitter"):n]})},[]),Q=i.useCallback(function(){var o=O(g().mark(function n(r){var t,u,l;return g().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=k==null?void 0:k(r),C&&t instanceof Promise&&(w(!0),u=setTimeout(function(){return w(!1)},C),t.finally(function(){clearTimeout(u),w(!1)})),c.next=4,t;case 4:return l=c.sent,l&&d(!1),c.abrupt("return",l);case 7:case"end":return c.stop()}},n)}));return function(n){return o.apply(this,arguments)}}(),[k,d,C]),X=te(M);return f.jsxs(f.Fragment,{children:[f.jsx(ie,v(v(v({title:H,width:A||800},e),X),{},{onCancel:function(n){var r;C&&y||(d(!1),e==null||(r=e.onCancel)===null||r===void 0||r.call(e,n))},afterClose:function(){var n;U(),M&&d(!1),e==null||(n=e.afterClose)===null||n===void 0||n.call(e)},footer:a.submitter!==!1?f.jsx("div",{ref:N,style:{display:"flex",justifyContent:"flex-end"}}):null,children:f.jsx(ae,v(v({formComponentType:"ModalForm",layout:"vertical"},a),{},{onInit:function(n,r){var t;a.formRef&&(a.formRef.current=r),a==null||(t=a.onInit)===null||t===void 0||t.call(a,n,r),b.current=r},formRef:b,submitter:J,onFinish:function(){var o=O(g().mark(function n(r){var t;return g().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Q(r);case 2:return t=l.sent,l.abrupt("return",t);case 4:case"end":return l.stop()}},n)}));return function(n){return o.apply(this,arguments)}}(),contentRender:K,children:D}))})),W]})}export{fe as M};
