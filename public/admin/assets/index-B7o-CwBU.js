const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wpO2ZOCX.js","assets/index-CxoETvRH.js","assets/index-4ObyrmBg.css","assets/index-BphrQzO9.js","assets/gapSize-U1swVQyS.js","assets/index-4oTavk15.js","assets/getAllowClear-61dfOySQ.js","assets/Input-DBs5aIW3.js","assets/TextArea-B06lod9y.js","assets/index-C-0gitmI.js","assets/index-Bx08vOBg.js","assets/DeleteOutlined-CBiNWy3g.js","assets/PlusOutlined-vk23tUE5.js","assets/index-DqM5KTQR.js","assets/index-DPelJOqh.js"])))=>i.map(i=>d[i]);
import{j as e,x as N,B as D,r as u,v as B,A as k,w as E,u as z,L as P,_ as O}from"./index-CxoETvRH.js";import{c as I}from"./config-Cbfhm-dN.js";import{u as H,S as K,v as U,a as W,s as $}from"./sortable.esm-DvJq2Omu.js";import{C as G,u as J,a as q,D as Q,c as X,K as Y,P as Z}from"./core.esm-CS6-g6X4.js";import{C as ee}from"./index-BLklr69N.js";import{B as te}from"./index-CHnZ-yQ1.js";import{W as y}from"./index-B5gW4Hci.js";import{F as f}from"./index-DiLyVsjM.js";import{P as ae}from"./index-K8hm1ODa.js";import{P as v}from"./index-BV5Zm_mO.js";import{u as ie}from"./index-LJrl3qH-.js";import{W as R}from"./index-DqNJzPla.js";import{P as le}from"./index-DsYJmDxZ.js";import{M as re}from"./index-B6rUILzb.js";import{r as se}from"./modifiers.esm-CORYu5Ec.js";import{P as b}from"./ProCard-D6QkQ_g5.js";import{A as oe}from"./index-BnwvW9ps.js";import{D as de}from"./index-BiKlR4w8.js";import{S as ne}from"./index-BphrQzO9.js";import{P as me}from"./index-CKDIzB68.js";import"./index-CVyj0YhM.js";import"./EllipsisOutlined-DYRNvKIw.js";import"./Overflow-C1Gv4RUW.js";import"./index-C-0gitmI.js";import"./PlusOutlined-vk23tUE5.js";import"./Dropdown-B_0_MLsu.js";import"./getAllowClear-61dfOySQ.js";import"./index-JNVvr94D.js";import"./index-DPelJOqh.js";import"./index-CvzSf1Bg.js";import"./BaseForm-Ce_dWbWI.js";import"./CopyOutlined-DoMFKUVx.js";import"./DeleteOutlined-CBiNWy3g.js";import"./row-qzGwq4Dr.js";import"./useBreakpoint-9N_aLd03.js";import"./index-C_bV-DnG.js";import"./DownOutlined-CKTuMrT9.js";import"./index-Bcl-gWmM.js";import"./index-lKg4xbVK.js";import"./index-lhHkabfZ.js";import"./index-Dx6Z95tT.js";import"./CheckOutlined-DNlRZmOM.js";import"./progress-Ofxp_QxA.js";import"./index-4oTavk15.js";import"./Input-DBs5aIW3.js";import"./TextArea-B06lod9y.js";import"./index-CVCROCWL.js";import"./addEventListener-DSaIWks1.js";import"./iconUtil-CrL5XMUw.js";import"./index-BbWS0DN_.js";import"./PurePanel-Qn0-6z3A.js";import"./move-BEwii-fV.js";import"./index-BCcQRwwP.js";import"./LeftOutlined-CXR1ue2q.js";import"./index-r-JVz4Yx.js";import"./index-BZDhPRiF.js";import"./index-BOtvnYjU.js";import"./gapSize-U1swVQyS.js";import"./dropdown-0heBmOdg.js";import"./index-27J4tOGW.js";import"./Sider-DIX9tLFZ.js";const pe=[{title:"文本",children:[{valueType:"text",valueTypeTitle:"文本"},{valueType:"textarea",valueTypeTitle:"多行文本"},{valueType:"password",valueTypeTitle:"密码框"}]},{title:"数字",children:[{valueType:"digit",valueTypeTitle:"数字"},{valueType:"digitRange",valueTypeTitle:"数字范围输入"}]},{title:"日期",children:[{valueType:"date",valueTypeTitle:"日期选择"},{valueType:"dateTime",valueTypeTitle:"日期+时间"},{valueType:"dateRange",valueTypeTitle:"日期区间"},{valueType:"dateTimeRange",valueTypeTitle:"日期+时间区间"}]},{title:"时间",children:[{valueType:"time",valueTypeTitle:"时间选择"},{valueType:"timeRange",valueTypeTitle:"时间区间"}]},{title:"选择类",children:[{valueType:"select",valueTypeTitle:"下拉选择"},{valueType:"checkbox",valueTypeTitle:"多选"},{valueType:"radio",valueTypeTitle:"单选"},{valueType:"switch",valueTypeTitle:"开关"}]},{title:"上传",children:[{valueType:"uploadImg",valueTypeTitle:"单图上传"},{valueType:"uploadImgAll",valueTypeTitle:"多图上传"},{valueType:"uploadImgVideoAll",valueTypeTitle:"多图/视频上传"},{valueType:"uploadFile",valueTypeTitle:"单文件上传"},{valueType:"uploadFileAll",valueTypeTitle:"多文件上传"}]},{title:"地理位置",children:[{valueType:"tencentMap",valueTypeTitle:"腾讯地图经纬度选择"},{valueType:"province",valueTypeTitle:"省选择"},{valueType:"provinceCity",valueTypeTitle:"省市选择"},{valueType:"provinceCityArea",valueTypeTitle:"省市区选择"}]},{title:"其它",children:[{valueType:"teditor",valueTypeTitle:"编辑器"}]}],ue=({data:a,delFields:m,setUpdateData:c})=>{const{attributes:n,listeners:h,setNodeRef:t,transform:i,transition:g,isDragging:p}=H({id:a.id}),d={transform:G.Transform.toString(i),marginBottom:"12px",cursor:"pointer"};return e.jsx(e.Fragment,{children:e.jsx(ee,{title:`${a.valueTypeTitle} ${a.name}`,size:"small",style:d,className:p?"dragon":"",ref:t,...n,...h,extra:e.jsxs(e.Fragment,{children:[e.jsx(D,{size:"small",type:"link",onClick:()=>{c(a)},children:"设置"}),e.jsx(D,{size:"small",type:"link",danger:!0,onClick:()=>{m(a.id)},children:"删除"})]}),children:e.jsx(te,{shouldUpdate:!0,columns:[N(a)],submitter:!1})})})},ce=({fields:a,setFields:m,type:c})=>{const n=u.useRef(),h=B(),{message:t}=k.useApp(),[i]=E(),[g,p]=u.useState(0);z(()=>{let o=i.get("id");o&&(p(o),I.findData({id:o}).then(x=>{var T;x.code===1?(m(x.data.fields_config),(T=n==null?void 0:n.current)==null||T.setFieldsValue(x.data)):(t.error(x.message),d())}))});const d=()=>{h("/config")};return e.jsx(e.Fragment,{children:e.jsxs(v,{formRef:n,layout:"vertical",omitNil:!1,onFinish:async o=>{if(a.length===0)return t.error("还没有添加表单字段~"),!1;if(a.some(S=>!S.name))return t.error("表单字段未设置完~"),!1;let x={fields_config:a,type:c,id:g,...o};c==="list"&&(x.fields_config=[{title:"",valueType:"formList",dataIndex:"content",name:"content",columns:a}]);let T=g?await I.update(x):await I.create(x);if(T.code===1)return t.success(T.message),d(),!0;t.error(T.message)},children:[e.jsx(y,{name:"title",label:"配置名称（中文）",placeholder:"请输入",rules:[{required:!0,message:"请输入"}]}),e.jsx(y,{name:"name",label:"配置名称（英文）",placeholder:"请输入",extra:"唯一，获取配置就用它",rules:[{required:!0,message:"请输入"}]}),c==="list"?e.jsx(e.Fragment,{children:e.jsx(f,{label:"列表最大条数",name:"list_number",min:1,fieldProps:{precision:0},placeholder:"请输入",rules:[{required:!0,message:"请输入"}]})}):"",e.jsx(ae,{name:"description",label:"配置说明",placeholder:"请输入",fieldProps:{autoSize:{minRows:2,maxRows:6}}})]})})},F=u.lazy(()=>O(()=>import("./index-wpO2ZOCX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),xe=a=>{var h;const m=u.useRef(),[c,n]=u.useState(!1);return ie(()=>{var t;(t=a.data)!=null&&t.id&&n(!0)},[a.data]),e.jsxs(re,{name:"settingFields",formRef:m,open:c,onOpenChange:t=>{var i;n(t),t===!1&&(a.setUpdateData({}),(i=m==null?void 0:m.current)==null||i.resetFields())},title:"设置字段参数",grid:!0,initialValues:{required:1},rowProps:{gutter:[24,0]},modalProps:{destroyOnClose:!0},params:{id:(h=a.data)==null?void 0:h.id},request:()=>{var t;return(t=a.data)==null?void 0:t.updateFields},colProps:{md:12,xs:24},isKeyPressSubmit:!0,omitNil:!1,onFinish:async t=>{var p,d;let i=a.data;i.updateFields=t,i.dataIndex=t.name,i.name=t.name,i.title=t.title,i.formItemProps.extra=t.extra,i.formItemProps.rules=[],["text","digit","digitRange"].indexOf(a.data.valueType)!==-1&&(i.fieldProps.addonBefore=t.addonBefore,i.fieldProps.addonAfter=t.addonAfter),t.required===2&&i.formItemProps.rules.push({required:!0,message:"必填"}),a.data.valueType==="digit"&&(t.min!==void 0&&(i.fieldProps.min=t.min),t.max!==void 0&&(i.fieldProps.max=t.max)),a.data.valueType==="time"&&(i.fieldProps.format="HH:mm"),a.data.valueType==="timeRange"&&(i.fieldProps.format="HH:mm"),a.data.valueType==="select"&&(i.fieldProps.options=[],t.mode!==1&&(i.fieldProps.mode=t.mode),t.mode!=="tags"&&t.select.map(o=>{i.fieldProps.options.push({value:o,label:o})})),a.data.valueType==="checkbox"&&(i.fieldProps.options=t.options),a.data.valueType==="radio"&&(i.fieldProps.options=[],t.options.map(o=>{i.fieldProps.options.push({value:o,label:o})})),a.data.valueType==="uploadImg"&&(t.width!==void 0&&(i.fieldProps.width=t.width),t.height!==void 0&&(i.fieldProps.height=t.height)),a.data.valueType==="uploadImgAll"&&(t.width!==void 0&&(i.fieldProps.width=t.width),t.height!==void 0&&(i.fieldProps.height=t.height),t.maxCount!==void 0&&(i.fieldProps.maxCount=t.maxCount)),a.data.valueType==="uploadFile"&&(i.fieldProps.accept=t.accept),a.data.valueType==="uploadFileAll"&&(t.maxCount!==void 0&&(i.fieldProps.maxCount=t.maxCount),i.fieldProps.accept=t.accept??[]);const g=await a.updateFields(i);return g&&((d=(p=m.current)==null?void 0:p.resetFields)==null||d.call(p)),g},children:[e.jsx(y,{name:"name",label:"字段name",placeholder:"请输入",rules:[{required:!0,message:"请输入"}],extra:"英文、需要整个表单唯一"}),e.jsx(y,{name:"title",label:"字段标题",placeholder:"请输入",rules:[{required:!0,message:"请输入"}]}),e.jsx(y,{name:"extra",label:"填写时候的帮助提示",placeholder:"请输入"}),e.jsx(R.Group,{name:"required",label:"是否必填",options:[{label:"否",value:1},{label:"是",value:2}],rules:[{required:!0,message:"请选择"}]}),a.data.valueType==="digit"?e.jsxs(e.Fragment,{children:[e.jsx(f,{name:"min",label:"最小值",placeholder:"请输入"}),e.jsx(f,{name:"max",label:"最大值",placeholder:"请输入"})]}):"",a.data.valueType==="select"?e.jsxs(e.Fragment,{children:[e.jsx(R.Group,{name:"mode",label:"类型",value:1,options:[{label:"单选下拉",value:1},{label:"多选下拉",value:"multiple"},{label:"标签输入框",value:"tags"}]}),e.jsx(le,{name:["mode"],children:({mode:t})=>{if(t!=="tags")return e.jsx(P,{children:e.jsx(v.Item,{name:"select",label:"下拉框选择项",style:{padding:"0px 12px"},extra:"输入后直接回车即可",rules:[{required:!0,message:"请输入"}],children:e.jsx(F,{})})})}})]}):"",a.data.valueType==="checkbox"?e.jsx(e.Fragment,{children:e.jsx(P,{children:e.jsx(v.Item,{name:"options",label:"选择项",style:{padding:"0px 12px"},extra:"输入后直接回车即可",rules:[{required:!0,message:"请输入"}],children:e.jsx(F,{})})})}):"",a.data.valueType==="radio"?e.jsx(e.Fragment,{children:e.jsx(P,{children:e.jsx(v.Item,{name:"options",label:"选择项",style:{padding:"0px 12px"},extra:"输入后直接回车即可",rules:[{required:!0,message:"请输入"}],children:e.jsx(F,{})})})}):"",a.data.valueType==="uploadImg"?e.jsxs(e.Fragment,{children:[e.jsx(f,{name:"width",label:"图片裁剪宽度",placeholder:"请输入",min:0,extra:"0为不限制"}),e.jsx(f,{name:"height",label:"图片裁剪高度",placeholder:"请输入",min:0,extra:"0为不限制"})]}):"",a.data.valueType==="uploadImgAll"?e.jsxs(e.Fragment,{children:[e.jsx(f,{name:"width",label:"图片裁剪宽度",placeholder:"请输入",min:0,extra:"0为不限制"}),e.jsx(f,{name:"height",label:"图片裁剪高度",placeholder:"请输入",min:0,extra:"0为不限制"}),e.jsx(f,{name:"maxCount",label:"最多可上传多少张图片",placeholder:"请输入",min:1,extra:"默认为10张"})]}):"",a.data.valueType==="uploadFile"?e.jsx(e.Fragment,{children:e.jsx(P,{children:e.jsx(v.Item,{name:"accept",label:"允许上传的文件后缀",style:{padding:"0px 12px"},extra:"如docx、zip、jpg，输入后直接回车即可",rules:[{required:!0,message:"请输入"}],children:e.jsx(F,{})})})}):"",a.data.valueType==="uploadFileAll"?e.jsxs(e.Fragment,{children:[e.jsx(f,{name:"maxCount",label:"最大上传文件数量",placeholder:"请输入",min:1,extra:"默认为10"}),e.jsx(P,{children:e.jsx(v.Item,{name:"accept",label:"允许上传的文件后缀",style:{padding:"0px 12px"},extra:"如docx、zip、jpg，输入后直接回车即可",rules:[{required:!0,message:"请输入"}],children:e.jsx(F,{})})})]}):"",["text","digit","digitRange"].indexOf(a.data.valueType)!==-1?e.jsxs(e.Fragment,{children:[e.jsx(y,{name:"addonBefore",label:"输入框的前缀",placeholder:"请输入"}),e.jsx(y,{name:"addonAfter",label:"输入框的后缀",placeholder:"请输入"})]}):""]})},fe=u.lazy(()=>O(()=>import("./index-DqM5KTQR.js"),__vite__mapDeps([13,1,2,14]))),Ft=()=>{const a=u.useRef(),m=B(),{message:c}=k.useApp(),[n]=E(),[h,t]=u.useState(0),[i,g]=u.useState("");z(()=>{let l=n.get("id");g(n.get("type")),l&&(t(l),I.findData({id:l}).then(r=>{var s;r.code===1?(o(r.data.type==="form"?r.data.fields_config:r.data.fields_config[0].columns),(s=a==null?void 0:a.current)==null||s.setFieldsValue(r.data)):(c.error(r.message),p())}))});const p=()=>{m("/config")},[d,o]=u.useState([]),x=l=>{let r=[...d],s={id:Date.now(),dataIndex:Date.now(),...l,name:"",title:"",formItemProps:{rules:[],style:{width:"100%"}},fieldProps:{style:{width:"100%"}},fields:[],updateFields:{}};r.push(s),o(r),C(s)},T=l=>{let r=[...d];r.splice(r.findIndex(s=>s.id===l),1),o(r)},S=l=>new Promise(r=>{let s=[...d];s.some(j=>{let w=l.id!=j.id&&j.dataIndex===l.dataIndex;return j.id===l.id&&(j={...l}),w})&&(c.error("字段name名称重复~"),r(!1)),o(s),r(!0)}),[L,C]=u.useState({}),V=J(q(Z,{activationConstraint:{distance:5}}),q(Y,{coordinateGetter:$})),M=l=>{const{active:r,over:s}=l;if(r.id!==(s==null?void 0:s.id)){let _=(()=>{const j=d.findIndex(A=>A.id===r.id),w=d.findIndex(A=>A.id===(s==null?void 0:s.id));return W(d,j,w)})();o(_)}};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{data:L,setUpdateData:C,updateFields:S}),e.jsx(me,{ghost:!0,header:{title:h?`修改${i}配置`:`添加${i}配置`,style:{padding:"0 24px 12px"},onBack:p},children:e.jsxs(b,{split:"vertical",children:[e.jsx(b,{colSpan:{xs:24,sm:6,md:5},children:e.jsx(ce,{fields:d,setFields:o,type:i})}),e.jsxs(b,{colSpan:{xs:24,sm:10,md:12},style:{height:"100%"},bodyStyle:{display:"flex",flexDirection:"column"},children:[e.jsx(oe,{message:"点击右侧增加表单组件，组件可以拖拽排序~",type:"warning",showIcon:!0,style:{marginBottom:"24px"}}),e.jsx(fe,{children:e.jsx(Q,{sensors:V,collisionDetection:X,onDragEnd:M,children:e.jsx(K,{items:d.map(l=>l.id),strategy:U,modifiers:[se],children:d.map(l=>e.jsx(ue,{data:l,delFields:T,setUpdateData:C},l.id))})})})]}),e.jsx(b,{title:"表单组件",colSpan:{xs:24,sm:8,md:7},children:pe.map(l=>e.jsxs("div",{children:[e.jsx(de,{orientation:"left",children:l.title},l.title),e.jsx(ne,{wrap:!0,children:l.children.map((r,s)=>e.jsx(D,{type:"dashed",onClick:()=>x(r),children:r.valueTypeTitle},s))})]},l.title))})]})})]})};export{Ft as default};
