import{j as e,B as L,A as W,r as d,dj as T,c as w}from"./index-BTXTJVKt.js";import{u as U,s as C,S as V,r as N,a as G}from"./sortable.esm-SPVu0F2Y.js";import{C as J,u as F,a as z,K as P,P as k,D as H,c as Y}from"./core.esm-Ds3LvBvm.js";import{C as q}from"./index-CM2B2jkZ.js";import{P as K}from"./progress-C-smal5r.js";import{R as _}from"./index-DZ2tAw4A.js";import{R as $}from"./DeleteOutlined-sMe1csST.js";import{I as AA}from"./antd-img-crop.esm-BiYxeaxO.js";import{f as eA}from"./file-HyvBP1Hh.js";import{r as rA}from"./modifiers.esm-NNQVQqFl.js";import{U as h}from"./index-Bms52pX5.js";import{R as sA}from"./PlusOutlined-DhDAnJdR.js";import{T as f}from"./index-Dx9hPCiE.js";import{I as O}from"./index-Cpu1JcVa.js";import"./index-CHGWkdWj.js";import"./EllipsisOutlined-BzWcE7tF.js";import"./Overflow-DodMVMUF.js";import"./index-DWyRM-jO.js";import"./Dropdown-D-FCcTPI.js";import"./getAllowClear-SV9Asyat.js";import"./DownOutlined-dHMiLU6h.js";import"./CheckOutlined-CRheHqkM.js";import"./Input-CJszbmX7.js";import"./TextArea-Dm9DBQS4.js";import"./index-JJDTxIwy.js";import"./PurePanel-BJ0dSvru.js";import"./useBreakpoint-C9P5ZgXD.js";import"./EditOutlined-Jb-cOsu8.js";import"./styleChecker-xca8e-q0.js";import"./CopyOutlined-Bqo58qRo.js";import"./index-DwWsiyHK.js";import"./index-BaexhYUL.js";import"./BaseForm-Bt-x2uS5.js";import"./row-DJNm5-9Y.js";import"./index-CsweGtVO.js";import"./index-CBjIPB84.js";import"./index-B1B7dhZb.js";import"./gapSize-U1swVQyS.js";import"./addEventListener-BQxGY-6f.js";import"./iconUtil-0otcsGdb.js";import"./index-D1w3VCkm.js";import"./move-BiL2XrK1.js";import"./index-Ci-Y97rG.js";import"./LeftOutlined-CNJksXTb.js";import"./index-Wn9_u9d6.js";import"./index-BfhOKpHw.js";import"./index-D5nMW6Hn.js";const iA=new URL("data:image/jpeg;base64,/9j/4AAQSkZJRgABAgAAZABkAAD/7AARRHVja3kAAQAEAAAAZAAA/+EDKGh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgV2luZG93cyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozMzFGNDA5NzBEMjAxMUVGOUVBOEE0OTAwQTYxOEMyOCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozMzFGNDA5ODBEMjAxMUVGOUVBOEE0OTAwQTYxOEMyOCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjMzMUY0MDk1MEQyMDExRUY5RUE4QTQ5MDBBNjE4QzI4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjMzMUY0MDk2MEQyMDExRUY5RUE4QTQ5MDBBNjE4QzI4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEB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",import.meta.url).href,tA=({data:i,preview:j,remove:n})=>{const{attributes:l,listeners:o,setNodeRef:p,transform:t,transition:m,isDragging:c}=U({id:i.img}),x={transform:J.Transform.toString(t),transition:m};return e.jsxs(q,{size:"small",styles:{body:{padding:8}},style:x,ref:p,className:c?"dragon upload-img":"upload-img",...l,...o,children:[i.status==="uploading"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg",style:{alignItems:"center",display:"flex"},children:e.jsx(K,{percent:i.percent,size:"small",showInfo:!1})})}):"",i.status==="done"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg",children:[["jpg","jpeg","png"].indexOf(i.url.substring(i.url.lastIndexOf(".")+1))==-1?e.jsx(e.Fragment,{children:e.jsx("img",{src:iA},i.url)}):e.jsx(e.Fragment,{children:e.jsx("img",{src:i.url},i.url)}),e.jsx("div",{className:"hover",children:e.jsxs("div",{children:[e.jsx(L,{type:"text",size:"small",onClick:()=>j(i),children:e.jsx(_,{className:"icon"})}),e.jsx(L,{type:"text",size:"small",onClick:()=>n(i),children:e.jsx($,{className:"icon"})})]})})]})}):""]},i.uid)},$A=({value:i=[],onChange:j,width:n=0,height:l=0,maxCount:o=10})=>{const{message:p}=W.useApp(),[t,m]=d.useState([]);d.useEffect(()=>{if(I===0&&Array.isArray(i)&&(i==null?void 0:i.length)>0){let A=[];i.map(r=>{A.push({status:"done",url:r.url,img:r.url,uid:r.url,thumbUrl:r.thumbUrl})}),D(A.length),m(A)}},[i]);const[c,x]=d.useState(!1),[Q,y]=d.useState(0),M=()=>{x(!c)},R=A=>{A.file.status==="error"&&p.error("上传出错~"),A.file.status==="done"&&(A.file.response.code===1?A.fileList.some(r=>{if(r.uid===A.file.uid)return["image/jpeg","image/jpg","image/png"].indexOf(A.file.type)!==-1&&(r.url=A.file.response.data.img,r.thumbUrl=A.file.response.data.img,r.img=A.file.response.data.img),["audio/mp4","video/mp4"].indexOf(A.file.type)!==-1&&(r.url=A.file.response.data.img,r.thumbUrl=A.file.response.data.img,r.img=A.file.response.data.img),!0}):(A.fileList=A.fileList.filter(r=>r.uid!==A.file.uid),p.error(A.file.response.message))),m(A.fileList),A.file.status==="done"&&A.file.response.code===1&&b(A.fileList)},X=A=>{let r=[...t];return r.map((s,a)=>{if(s.img===A.img)return r.splice(a,1),!1}),m(r),b(r),!1},v=A=>{t.some((r,s)=>{if(r.uid===A.uid)return y(s),!0}),M()},[I,D]=d.useState(0),b=A=>{let r=[];A.map(s=>{if(s.status==="done"){let a=s.img.substring(s.img.lastIndexOf(".")+1),u="image";["jpg","jpeg","png"].indexOf(a)==-1&&(u="video");let g="";s.thumbUrl&&(g=s.thumbUrl),r.push({url:s.img,type:u,thumbUrl:g})}}),D(r.length),j(r)},S=A=>{if(["image/jpeg","image/jpg","image/png","audio/mp4","video/mp4"].indexOf(A.type)==-1)return p.error("只能上传图片或视频~"),h.LIST_IGNORE;if(A.size/1024/1024>w.uploadImgMax)return p.error(`图片大小请控制在 ${w.uploadImgMax}M 以内`),h.LIST_IGNORE;if(t.length>=o)return!1},Z=F(z(k,{activationConstraint:{distance:5}}),z(P,{coordinateGetter:C})),B=A=>{const{active:r,over:s}=A;if(r.id!==(s==null?void 0:s.id)){let a=(()=>{const u=t.findIndex(E=>E.img===r.id),g=t.findIndex(E=>E.img===(s==null?void 0:s.id));return G(t,u,g)})();m(a),b(a)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{width:"100%",overflow:"hidden"},children:[e.jsx(H,{sensors:Z,collisionDetection:Y,onDragEnd:B,modifiers:[rA],children:e.jsx(V,{items:t.map(A=>A.uid),strategy:N,children:t.map(A=>e.jsx(tA,{data:A,preview:v,remove:X},A.uid))})}),e.jsx("div",{style:{width:"auto",overflow:"hidden",display:I>=o?"none":"inline-block"},children:e.jsx(AA,{rotationSlider:!0,quality:1,fillColor:"rgba(0,0,0,0)",cropShape:"rect",aspect:()=>n/l,beforeCrop:A=>{if(A.type.indexOf("image")==-1||n<=0||l<=0)return!1},children:e.jsx(h,{accept:"image/*,audio/mp4,video/mp4",capture:null,name:"img",listType:"picture-card",action:eA.uploadUrl,headers:{token:T()},data:{width:n,height:l},onChange:R,fileList:t,maxCount:o,beforeUpload:S,showUploadList:!1,children:e.jsxs("div",{children:[e.jsx(sA,{}),e.jsx("div",{className:"ant-upload-text",children:"上传"})]})})})})]}),n>0&&l>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["可上传图片或视频，请上传宽高：",n,"*",l,"的图片，最多可上传",o,"张或视频，上传后可拖动排序~"]})}):e.jsx(e.Fragment,{children:n>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["可上传图片或视频，请上传宽为",n,"px的图片，最多可上传",o,"张或视频，上传后可拖动排序~"]})}):e.jsx(e.Fragment,{children:l>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["可上传图片或视频，请上传高为",l,"px的图片，最多可上传",o,"张或视频，上传后可拖动排序~"]})}):e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["可上传图片或视频，最多可上传",o,"张图片或视频，上传后可拖动排序~"]})})})}),e.jsx("div",{style:{display:"none"},children:e.jsx(O.PreviewGroup,{preview:{visible:c,onVisibleChange:M,current:Q,imageRender:A=>{var r;if((r=A.props)!=null&&r.src){let s=A.props.src.substring(A.props.src.lastIndexOf(".")+1);if(["jpg","jpeg","png"].indexOf(s)==-1)return e.jsx("video",{muted:!0,width:"500",height:"300",controls:!0,src:A.props.src},A.props.src)}return e.jsx("div",{children:A},A.props.src)},toolbarRender:(A,r)=>{let s=t[r.current],a=s.url.substring(s.url.lastIndexOf(".")+1);return["jpg","jpeg","png"].indexOf(a)==-1?null:A},onChange:A=>{y(A)}},children:t.map(A=>A.status==="done"?e.jsx(e.Fragment,{children:e.jsx(O,{src:A.url},A.url)}):null)})})]})};export{$A as default};
