import{A as R,u as $,r as l,j as i,dj as D,B as Q,c as V}from"./index-CxoETvRH.js";import{f as p}from"./file-Clf_3ubf.js";import{U as f}from"./index-BDTAXPlV.js";import{R as C}from"./UploadOutlined-BpULMQ6Q.js";import{T as K}from"./index-DdonXCdW.js";import"./useBreakpoint-9N_aLd03.js";import"./DeleteOutlined-CBiNWy3g.js";import"./index-4oTavk15.js";import"./getAllowClear-61dfOySQ.js";import"./Input-DBs5aIW3.js";import"./TextArea-B06lod9y.js";import"./index-C-0gitmI.js";import"./progress-Ofxp_QxA.js";import"./DownOutlined-CKTuMrT9.js";import"./CheckOutlined-DNlRZmOM.js";import"./EditOutlined-DSBmrQxq.js";import"./styleChecker-BWYb9pEX.js";import"./CopyOutlined-DoMFKUVx.js";const re=({value:s,onChange:S,UploadButton:n=null,accept:c=["docx","ppt"],disk:a="public",maxSize:m=V.uploadFileMax})=>{const{message:u}=R.useApp();$(()=>{a=="aliyun"&&g(),a=="qcloud"&&A(c[0])});const[r,q]=l.useState({}),g=async()=>{const e=await p.getSignature();e.code===1?q(e.data):u.error(e.message)},[y,j]=l.useState({}),A=async e=>{const t=await p.getQcloudSignature({dir:e});t.code===1?j(t.data):u.error(t.message)},[w,T]=l.useState([]),[d,x]=l.useState([]);l.useEffect(()=>{w!=s&&(s!=null&&s.name)&&(s!=null&&s.url)&&x([{uid:1,name:s.name,status:"done",value_url:s.url,url:`${s.url}`,thumbUrl:`${s.url}`}])},[s]);const L=e=>{e.file.status==="uploading"&&n&&u.open({type:"loading",content:"正在上传...",duration:0,key:"upload"}),e.file.status!=="uploading"&&n&&u.destroy("upload"),e.file.status==="error"&&u.error("上传出错~"),e.file.status==="done"&&(a=="public"&&(e.file.response.code===1?e.fileList.map(t=>{t.uid===e.file.uid&&(t.value_url=t.response.data.file,t.url=`${t.response.data.file}`)}):u.error("上传出错~")),a=="aliyun"&&e.fileList.map(t=>{if(t.uid===e.file.uid){let o=r.host+"/"+e.file.url;t.value_url=o,t.url=o}}),a=="qcloud"&&e.fileList.map(t=>{if(t.uid===e.file.uid){let o=y.cosHost+"/"+e.file.url;t.value_url=o,t.url=o}})),x(e.fileList)},_=async e=>{let t=e.name.split("."),o=t[t.length-1];if(c.indexOf(o)===-1)return u.error("文件格式错误，不允许上传的文件类型~"),f.LIST_IGNORE;if(e.size/1024/1024>m)return u.error(`上传失败，文件大小请控制在 ${m}M 以内`),f.LIST_IGNORE;if(a=="aliyun")return Number(r.expire)*1e3<Date.now()&&await g(),e.url=r.dir+o+"/"+Date.now()+"."+o,e;if(a=="qcloud"){const F=new Date().toISOString().split("T")[0];return e.url=F+"/"+o+"/"+Date.now()+"."+o,e}};l.useEffect(()=>{let e={};d.map(t=>{t.status==="done"&&t.value_url&&(e={name:t.name,url:t.value_url})}),S(e!=null&&e.name?e:null),T(e)},[d]);const[h,E]=l.useState([]);l.useEffect(()=>{if(c.length>0){let e=[];c.map(t=>{t&&e.push(`.${t}`)}),E(e)}},[c]);const I=async e=>{if(a=="aliyun")return{key:e.url,OSSAccessKeyId:r==null?void 0:r.accessid,policy:r==null?void 0:r.policy,Signature:r==null?void 0:r.signature};if(a=="qcloud"){const t=await p.getQcloudSignature({dir:e.url});return{key:t.data.cosKey,policy:t.data.policy,success_action_status:200,"q-sign-algorithm":t.data.qSignAlgorithm,"q-ak":t.data.qAk,"q-key-time":t.data.qKeyTime,"q-signature":t.data.qSignature}}return{}};return i.jsxs(i.Fragment,{children:[i.jsx(f,{accept:h,maxCount:1,name:"file",listType:"picture",fileList:d,action:a=="aliyun"?r.host:a=="qcloud"?y.cosHost:p.uploadUrl,showUploadList:!n,headers:a!="public"?{}:{token:D()},data:I,onChange:L,beforeUpload:_,children:n?i.jsx(n,{}):i.jsx(i.Fragment,{children:i.jsx(Q,{icon:i.jsx(C,{}),children:"选择文件"})})}),n?"":i.jsx(i.Fragment,{children:i.jsx("div",{style:{width:"100%"},children:i.jsxs(K.Text,{type:"secondary",children:["请上传",h.join(","),"类型的文件"]})})})]})};export{re as default};
