import{A as b,u as R,r as l,j as u,dj as U,B as V,c as $}from"./index-ZI51y314.js";import{f as p}from"./file-lMMXiPj9.js";import{U as f}from"./index-B-1LKTLM.js";import{R as D}from"./UploadOutlined-CSWPUXB-.js";import{T as Q}from"./index-Ig2XVJMn.js";import"./useBreakpoint-LlaO7o8U.js";import"./DeleteOutlined-BJQ6Ec5G.js";import"./index-CzgBx6dd.js";import"./getAllowClear-Bb8ihI2F.js";import"./Input-YyHXjDeB.js";import"./TextArea-CbhGwHw0.js";import"./index-BIgUuT9u.js";import"./progress-DyKaNkG9.js";import"./DownOutlined-BvFNYu2h.js";import"./CheckOutlined-BH5QPYjn.js";import"./EditOutlined-C2XE2Of8.js";import"./styleChecker-nFJfeipz.js";import"./CopyOutlined-Di_ABAcP.js";const ee=({value:o=[],onChange:x,accept:n=[],maxCount:d=10,disk:s="public",maxSize:g=$.uploadFileMax})=>{const{message:i}=b.useApp();R(()=>{s=="aliyun"&&m(),s=="qcloud"&&j(n[0])});const[r,q]=l.useState({}),m=async()=>{const t=await p.getSignature();t.code===1?q(t.data):i.error(t.message)},[h,A]=l.useState({}),j=async t=>{const e=await p.getQcloudSignature({dir:t});e.code===1?A(e.data):i.error(e.message)},[c,y]=l.useState([]);l.useEffect(()=>{if(c.length===0&&Array.isArray(o)&&(o==null?void 0:o.length)>0){let t=[];o.map((e,a)=>{t.push({uid:a+1,name:e.name,status:"done",value_url:e.url,url:`${e.url}`,thumbUrl:`${e.url}`})}),y(t)}},[o]);const _=t=>{t.file.status==="error"&&i.error("上传出错~"),t.file.status==="done"&&(s=="public"&&(t.file.response.code===1?t.fileList.map(e=>{e.uid===t.file.uid&&(e.value_url=e.response.data.file,e.url=`${e.response.data.file}`)}):i.error("上传出错~")),s=="aliyun"&&t.fileList.map(e=>{if(e.uid===t.file.uid){let a=r.host+"/"+t.file.url;e.value_url=a,e.url=a}}),s=="qcloud"&&t.fileList.map(e=>{if(e.uid===t.file.uid){let a=h.cosHost+"/"+t.file.url;e.value_url=a,e.url=a}})),y(t.fileList)},w=async t=>{let e=t.name.split("."),a=e[e.length-1];if(n.indexOf(a)===-1)return i.error("文件格式错误，不允许上传的文件类型~"),f.LIST_IGNORE;if(t.size/1024/1024>g)return i.error(`上传失败，文件大小请控制在 ${g}M 以内`),f.LIST_IGNORE;if(s=="aliyun")return Number(r.expire)*1e3<Date.now()&&await m(),t.url=r.dir+a+"/"+Date.now()+"."+a,t;if(s=="qcloud"){const I=new Date().toISOString().split("T")[0];return t.url=I+"/"+a+"/"+Date.now()+"."+a,t}};l.useEffect(()=>{let t=[];c.map(e=>{e.status==="done"&&e.value_url&&t.push({name:e.name,url:e.value_url})}),x(t)},[c]);const[S,T]=l.useState([]);l.useEffect(()=>{if(n.length>0){let t=[];n.map(e=>{e&&t.push(`.${e}`)}),T(t)}},[n]);const E=async t=>{if(s=="aliyun")return{key:t.url,OSSAccessKeyId:r==null?void 0:r.accessid,policy:r==null?void 0:r.policy,Signature:r==null?void 0:r.signature};if(s=="qcloud"){const e=await p.getQcloudSignature({dir:t.url});return{key:e.data.cosKey,policy:e.data.policy,success_action_status:200,"q-sign-algorithm":e.data.qSignAlgorithm,"q-ak":e.data.qAk,"q-key-time":e.data.qKeyTime,"q-signature":e.data.qSignature}}return{}};return u.jsxs(u.Fragment,{children:[u.jsx(f,{accept:S,maxCount:d,name:"file",listType:"picture",fileList:c,action:s=="aliyun"?r.host:s=="qcloud"?h.cosHost:p.uploadUrl,headers:s!="public"?{}:{token:U()},data:E,multiple:!0,onChange:_,beforeUpload:w,children:c.length<d?u.jsx(V,{icon:u.jsx(D,{}),children:"选择文件"}):""}),u.jsx("div",{style:{width:"100%"},children:u.jsxs(Q.Text,{type:"secondary",children:["最多上传 ",d," 个文件，允许上传的文件类型：",S.join(",")]})})]})};export{ee as default};
