import{j as e,B as v,A as $,r as d,dj as k,c as C}from"./index-BTXTJVKt.js";import{u as z,s as G,S as M,r as O,a as K}from"./sortable.esm-SPVu0F2Y.js";import{C as _,u as B,a as T,K as J,P as q,D as H,c as Q}from"./core.esm-Ds3LvBvm.js";/* empty css             */import{C as W}from"./index-CM2B2jkZ.js";import{P as X}from"./progress-C-smal5r.js";import{R as Y}from"./index-DZ2tAw4A.js";import{R as Z}from"./DeleteOutlined-sMe1csST.js";import{I as ee}from"./antd-img-crop.esm-BiYxeaxO.js";import{f as se}from"./file-HyvBP1Hh.js";import{r as re}from"./modifiers.esm-NNQVQqFl.js";import{U as y}from"./index-Bms52pX5.js";import{R as te}from"./PlusOutlined-DhDAnJdR.js";import{T as f}from"./index-Dx9hPCiE.js";import{I as F}from"./index-Cpu1JcVa.js";import"./index-CHGWkdWj.js";import"./EllipsisOutlined-BzWcE7tF.js";import"./Overflow-DodMVMUF.js";import"./index-DWyRM-jO.js";import"./Dropdown-D-FCcTPI.js";import"./getAllowClear-SV9Asyat.js";import"./DownOutlined-dHMiLU6h.js";import"./CheckOutlined-CRheHqkM.js";import"./Input-CJszbmX7.js";import"./TextArea-Dm9DBQS4.js";import"./index-JJDTxIwy.js";import"./PurePanel-BJ0dSvru.js";import"./useBreakpoint-C9P5ZgXD.js";import"./EditOutlined-Jb-cOsu8.js";import"./styleChecker-xca8e-q0.js";import"./CopyOutlined-Bqo58qRo.js";import"./index-DwWsiyHK.js";import"./index-BaexhYUL.js";import"./BaseForm-Bt-x2uS5.js";import"./row-DJNm5-9Y.js";import"./index-CsweGtVO.js";import"./index-CBjIPB84.js";import"./index-B1B7dhZb.js";import"./gapSize-U1swVQyS.js";import"./addEventListener-BQxGY-6f.js";import"./iconUtil-0otcsGdb.js";import"./index-D1w3VCkm.js";import"./move-BiL2XrK1.js";import"./index-Ci-Y97rG.js";import"./LeftOutlined-CNJksXTb.js";import"./index-Wn9_u9d6.js";import"./index-BfhOKpHw.js";import"./index-D5nMW6Hn.js";const ie=({data:t,preview:u,remove:n})=>{const{attributes:a,listeners:l,setNodeRef:p,transform:o,transition:m,isDragging:c}=z({id:t.img}),x={transform:_.Transform.toString(o),transition:m};return e.jsxs(W,{size:"small",styles:{body:{padding:8}},style:x,ref:p,className:c?"dragon upload-img":"upload-img",...a,...l,children:[t.status==="uploading"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg",style:{alignItems:"center",display:"flex"},children:e.jsx(X,{percent:t.percent,size:"small",showInfo:!1})})}):"",t.status==="done"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg",children:[e.jsx("img",{src:t.url}),e.jsx("div",{className:"hover",children:e.jsxs("div",{children:[e.jsx(v,{type:"text",size:"small",onClick:()=>u(t),children:e.jsx(Y,{className:"icon"})}),e.jsx(v,{type:"text",size:"small",onClick:()=>n(t),children:e.jsx(Z,{className:"icon"})})]})})]})}):""]},t.uid)},Ze=({value:t=[],onChange:u,width:n=0,height:a=0,maxCount:l=10})=>{const{message:p}=$.useApp(),[o,m]=d.useState([]);d.useEffect(()=>{if(b===0&&Array.isArray(t)&&(t==null?void 0:t.length)>0){let s=[];t.map(r=>{s.push({status:"done",url:`${r}`,img:r,uid:r})}),L(s.length),m(s)}},[t]);const[c,x]=d.useState(!1),[N,I]=d.useState(0),S=()=>{x(!c)},P=s=>{s.file.status==="error"&&p.error("上传出错~"),s.file.status==="done"&&(s.file.response.code===1?s.fileList.some(r=>{if(r.uid===s.file.uid)return r.url=`${s.file.response.data.img}`,r.thumbUrl=`${s.file.response.data.img}`,r.img=s.file.response.data.img,!0}):(s.fileList=s.fileList.filter(r=>r.uid!==s.file.uid),p.error(s.file.response.message))),m(s.fileList),s.file.status==="done"&&s.file.response.code===1&&j(s.fileList)},R=s=>{let r=[...o];return r.map((i,g)=>{if(i.img===s.img)return r.splice(g,1),!1}),m(r),j(r),!1},w=s=>{o.some((r,i)=>{if(r.uid===s.uid)return I(i),!0}),S()},[b,L]=d.useState(0),j=s=>{let r=[];s.map(i=>{i.status==="done"&&r.push(i.img)}),L(r.length),u(r)},E=s=>{if(!(s.type==="image/jpeg"||s.type==="image/png"))return p.error("只能上传图片~"),y.LIST_IGNORE;if(s.size/1024/1024>C.uploadImgMax)return p.error(`图片大小请控制在 ${C.uploadImgMax}M 以内`),y.LIST_IGNORE;if(o.length>=l)return!1},A=B(T(q,{activationConstraint:{distance:5}}),T(J,{coordinateGetter:G})),D=s=>{const{active:r,over:i}=s;if(r.id!==(i==null?void 0:i.id)){let g=(()=>{const U=o.findIndex(h=>h.img===r.id),V=o.findIndex(h=>h.img===(i==null?void 0:i.id));return K(o,U,V)})();m(g),j(g)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{width:"100%",overflow:"hidden"},children:[e.jsx(H,{sensors:A,collisionDetection:Q,onDragEnd:D,children:e.jsx(M,{items:o.map(s=>s.img),strategy:O,modifiers:[re],children:o.map(s=>e.jsx(ie,{data:s,preview:w,remove:R},s.uid))})}),e.jsx("div",{style:{width:"auto",overflow:"hidden",display:b>=l?"none":"inline-block"},children:e.jsx(ee,{rotationSlider:!0,quality:1,fillColor:"rgba(0,0,0,0)",cropShape:"rect",aspect:()=>n/a,beforeCrop:()=>{if(n<=0||a<=0)return!1},children:e.jsx(y,{accept:"image/*",capture:null,name:"img",listType:"picture-card",action:se.uploadUrl,headers:{token:k()},data:{width:n,height:a},onChange:P,fileList:o,maxCount:l,multiple:!(n>0&&a>0),beforeUpload:E,showUploadList:!1,children:e.jsxs("div",{children:[e.jsx(te,{}),e.jsx("div",{className:"ant-upload-text",children:"上传"})]})})})})]}),n>0&&a>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传宽高：",n,"*",a,"的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:n>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传宽为",n,"px的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:a>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传高为",a,"px的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["最多可上传",l,"张图片，上传后的图片可拖动排序~"]})})})}),e.jsx("div",{style:{display:"none"},children:e.jsx(F.PreviewGroup,{preview:{visible:c,onVisibleChange:S,current:N,onChange:s=>{I(s)}},children:o.map(s=>s.status==="done"?e.jsx(F,{src:s.url},s.url):"")})})]})};export{Ze as default};
