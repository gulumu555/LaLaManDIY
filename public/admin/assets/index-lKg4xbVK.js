import{al as p,am as N,an as pe,aA as he,f as H,r as d,ao as ge,az as _,aL as be,cG as Ce,j as f,aq as we,aM as V,aN as b,g as xe}from"./index-CxoETvRH.js";import{a as Re,b as $e,o as We,H as _e}from"./BaseForm-Ce_dWbWI.js";import{i as ze}from"./index-lhHkabfZ.js";import{u as Se}from"./index-DPelJOqh.js";import{D as ye}from"./index-Dx6Z95tT.js";var Fe=function(m){return N({},m.componentCls,{"&-sidebar-dragger":{width:"5px",cursor:"ew-resize",padding:"4px 0 0",borderTop:"1px solid transparent",position:"absolute",top:0,left:0,bottom:0,zIndex:100,backgroundColor:"transparent","&-min-disabled":{cursor:"w-resize"},"&-max-disabled":{cursor:"e-resize"}}})};function ke(s){return Se("DrawerForm",function(m){var h=p(p({},m),{},{componentCls:".".concat(s)});return[Fe(h)]})}var De=["children","trigger","onVisibleChange","drawerProps","onFinish","submitTimeout","title","width","resize","onOpenChange","visible","open"];function Ie(s){var m,h,Y=s.children,C=s.trigger,w=s.onVisibleChange,i=s.drawerProps,D=s.onFinish,x=s.submitTimeout,Z=s.title,z=s.width,c=s.resize,S=s.onOpenChange,y=s.visible,B=s.open,l=pe(s,De);he(!l.footer||!(i!=null&&i.footer),"DrawerForm 是一个 ProForm 的特殊布局，如果想自定义按钮，请使用 submit.render 自定义。");var o=H.useMemo(function(){var t,e,r,n={onResize:function(){},maxWidth:ze()?window.innerWidth*.8:void 0,minWidth:300};return typeof c=="boolean"?c?n:{}:Re({onResize:(t=c==null?void 0:c.onResize)!==null&&t!==void 0?t:n.onResize,maxWidth:(e=c==null?void 0:c.maxWidth)!==null&&e!==void 0?e:n.maxWidth,minWidth:(r=c==null?void 0:c.minWidth)!==null&&r!==void 0?r:n.minWidth})},[c]),R=d.useContext(ge.ConfigContext),U=R.getPrefixCls("pro-form-drawer"),A=ke(U),ee=A.wrapSSR,G=A.hashId,M=function(e){return"".concat(U,"-").concat(e," ").concat(G)},re=d.useState([]),ne=_(re,2),oe=ne[1],te=d.useState(!1),q=_(te,2),P=q[0],T=q[1],ie=d.useState(!1),X=_(ie,2),j=X[0],O=X[1],ae=d.useState(z||(c?o==null?void 0:o.minWidth:800)),J=_(ae,2),I=J[0],F=J[1],le=be(!!y,{value:B||y,onChange:S||w}),K=_(le,2),$=K[0],g=K[1],k=d.useRef(null),se=d.useCallback(function(t){k.current===null&&t&&oe([]),k.current=t},[]),W=d.useRef(),ue=d.useCallback(function(){var t,e,r,n=(t=(e=(r=l.formRef)===null||r===void 0?void 0:r.current)!==null&&e!==void 0?e:l.form)!==null&&t!==void 0?t:W.current;n&&i!==null&&i!==void 0&&i.destroyOnClose&&n.resetFields()},[i==null?void 0:i.destroyOnClose,l.form,l.formRef]);d.useEffect(function(){$&&(B||y)&&(S==null||S(!0),w==null||w(!0)),j&&F(o==null?void 0:o.minWidth)},[y,$,j]),d.useImperativeHandle(l.formRef,function(){return W.current},[W.current]);var de=d.useMemo(function(){return C?H.cloneElement(C,p(p({key:"trigger"},C.props),{},{onClick:function(){var t=V(b().mark(function r(n){var u,a;return b().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:g(!$),O(!Object.keys(o)),(u=C.props)===null||u===void 0||(a=u.onClick)===null||a===void 0||a.call(u,n);case 3:case"end":return v.stop()}},r)}));function e(r){return t.apply(this,arguments)}return e}()})):null},[g,C,$,O,j]),ce=d.useMemo(function(){var t,e,r,n,u;return l.submitter===!1?!1:Ce({searchConfig:{submitText:(t=(e=R.locale)===null||e===void 0||(e=e.Modal)===null||e===void 0?void 0:e.okText)!==null&&t!==void 0?t:"确认",resetText:(r=(n=R.locale)===null||n===void 0||(n=n.Modal)===null||n===void 0?void 0:n.cancelText)!==null&&r!==void 0?r:"取消"},resetButtonProps:{preventDefault:!0,disabled:x?P:void 0,onClick:function(L){var v;g(!1),i==null||(v=i.onClose)===null||v===void 0||v.call(i,L)}}},(u=l.submitter)!==null&&u!==void 0?u:{})},[l.submitter,(m=R.locale)===null||m===void 0||(m=m.Modal)===null||m===void 0?void 0:m.okText,(h=R.locale)===null||h===void 0||(h=h.Modal)===null||h===void 0?void 0:h.cancelText,x,P,g,i]),ve=d.useCallback(function(t,e){return f.jsxs(f.Fragment,{children:[t,k.current&&e?f.jsx(H.Fragment,{children:we.createPortal(e,k.current)},"submitter"):e]})},[]),fe=$e(function(){var t=V(b().mark(function e(r){var n,u,a;return b().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return n=D==null?void 0:D(r),x&&n instanceof Promise&&(T(!0),u=setTimeout(function(){return T(!1)},x),n.finally(function(){clearTimeout(u),T(!1)})),v.next=4,n;case 4:return a=v.sent,a&&g(!1),v.abrupt("return",a);case 7:case"end":return v.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),me=We($,w),E=d.useCallback(function(t){var e,r,n=(document.body.offsetWidth||1e3)-(t.clientX-document.body.offsetLeft),u=(e=o==null?void 0:o.minWidth)!==null&&e!==void 0?e:z||800,a=(r=o==null?void 0:o.maxWidth)!==null&&r!==void 0?r:window.innerWidth*.8;if(n<u){F(u);return}if(n>a){F(a);return}F(n)},[o==null?void 0:o.maxWidth,o==null?void 0:o.minWidth,z]),Q=d.useCallback(function(){document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",Q)},[E]);return ee(f.jsxs(f.Fragment,{children:[f.jsxs(ye,p(p(p({title:Z,width:I},i),me),{},{afterOpenChange:function(e){var r;e||ue(),i==null||(r=i.afterOpenChange)===null||r===void 0||r.call(i,e)},onClose:function(e){var r;x&&P||(g(!1),i==null||(r=i.onClose)===null||r===void 0||r.call(i,e))},footer:l.submitter!==!1&&f.jsx("div",{ref:se,style:{display:"flex",justifyContent:"flex-end"}}),children:[c?f.jsx("div",{className:xe(M("sidebar-dragger"),G,N(N({},M("sidebar-dragger-min-disabled"),I===(o==null?void 0:o.minWidth)),M("sidebar-dragger-max-disabled"),I===(o==null?void 0:o.maxWidth))),onMouseDown:function(e){var r;o==null||(r=o.onResize)===null||r===void 0||r.call(o),e.stopPropagation(),e.preventDefault(),document.addEventListener("mousemove",E),document.addEventListener("mouseup",Q),O(!0)}}):null,f.jsx(f.Fragment,{children:f.jsx(_e,p(p({formComponentType:"DrawerForm",layout:"vertical"},l),{},{formRef:W,onInit:function(e,r){var n;l.formRef&&(l.formRef.current=r),l==null||(n=l.onInit)===null||n===void 0||n.call(l,e,r),W.current=r},submitter:ce,onFinish:function(){var t=V(b().mark(function e(r){var n;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fe(r);case 2:return n=a.sent,a.abrupt("return",n);case 4:case"end":return a.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),contentRender:ve,children:Y}))})]})),de]}))}export{Ie as D};
