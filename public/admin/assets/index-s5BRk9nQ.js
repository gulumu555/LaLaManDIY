import{j as e,B as v,A as $,r as d,dj as k,c as C}from"./index-CxoETvRH.js";import{u as z,s as G,S as M,r as O,a as K}from"./sortable.esm-DvJq2Omu.js";import{C as _,u as B,a as T,K as J,P as q,D as H,c as Q}from"./core.esm-CS6-g6X4.js";/* empty css             */import{C as W}from"./index-BLklr69N.js";import{P as X}from"./progress-Ofxp_QxA.js";import{R as Y}from"./index-4oTavk15.js";import{R as Z}from"./DeleteOutlined-CBiNWy3g.js";import{I as ee}from"./antd-img-crop.esm-DlFTDGwj.js";import{f as se}from"./file-Clf_3ubf.js";import{r as re}from"./modifiers.esm-CORYu5Ec.js";import{U as y}from"./index-BDTAXPlV.js";import{R as te}from"./PlusOutlined-vk23tUE5.js";import{T as f}from"./index-DdonXCdW.js";import{I as F}from"./index-DsYJmDxZ.js";import"./index-CVyj0YhM.js";import"./EllipsisOutlined-DYRNvKIw.js";import"./Overflow-C1Gv4RUW.js";import"./index-C-0gitmI.js";import"./Dropdown-B_0_MLsu.js";import"./getAllowClear-61dfOySQ.js";import"./DownOutlined-CKTuMrT9.js";import"./CheckOutlined-DNlRZmOM.js";import"./Input-DBs5aIW3.js";import"./TextArea-B06lod9y.js";import"./index-BOtvnYjU.js";import"./PurePanel-Qn0-6z3A.js";import"./useBreakpoint-9N_aLd03.js";import"./EditOutlined-DSBmrQxq.js";import"./styleChecker-BWYb9pEX.js";import"./CopyOutlined-DoMFKUVx.js";import"./index-DPelJOqh.js";import"./index-CvzSf1Bg.js";import"./BaseForm-Ce_dWbWI.js";import"./row-qzGwq4Dr.js";import"./index-C_bV-DnG.js";import"./index-Bcl-gWmM.js";import"./index-BphrQzO9.js";import"./gapSize-U1swVQyS.js";import"./addEventListener-DSaIWks1.js";import"./iconUtil-CrL5XMUw.js";import"./index-BbWS0DN_.js";import"./move-BEwii-fV.js";import"./index-BCcQRwwP.js";import"./LeftOutlined-CXR1ue2q.js";import"./index-BiKlR4w8.js";import"./index-r-JVz4Yx.js";import"./index-BZDhPRiF.js";const ie=({data:t,preview:u,remove:n})=>{const{attributes:a,listeners:l,setNodeRef:p,transform:o,transition:m,isDragging:c}=z({id:t.img}),x={transform:_.Transform.toString(o),transition:m};return e.jsxs(W,{size:"small",styles:{body:{padding:8}},style:x,ref:p,className:c?"dragon upload-img":"upload-img",...a,...l,children:[t.status==="uploading"?e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg",style:{alignItems:"center",display:"flex"},children:e.jsx(X,{percent:t.percent,size:"small",showInfo:!1})})}):"",t.status==="done"?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg",children:[e.jsx("img",{src:t.url}),e.jsx("div",{className:"hover",children:e.jsxs("div",{children:[e.jsx(v,{type:"text",size:"small",onClick:()=>u(t),children:e.jsx(Y,{className:"icon"})}),e.jsx(v,{type:"text",size:"small",onClick:()=>n(t),children:e.jsx(Z,{className:"icon"})})]})})]})}):""]},t.uid)},Ze=({value:t=[],onChange:u,width:n=0,height:a=0,maxCount:l=10})=>{const{message:p}=$.useApp(),[o,m]=d.useState([]);d.useEffect(()=>{if(b===0&&Array.isArray(t)&&(t==null?void 0:t.length)>0){let s=[];t.map(r=>{s.push({status:"done",url:`${r}`,img:r,uid:r})}),L(s.length),m(s)}},[t]);const[c,x]=d.useState(!1),[N,I]=d.useState(0),S=()=>{x(!c)},P=s=>{s.file.status==="error"&&p.error("上传出错~"),s.file.status==="done"&&(s.file.response.code===1?s.fileList.some(r=>{if(r.uid===s.file.uid)return r.url=`${s.file.response.data.img}`,r.thumbUrl=`${s.file.response.data.img}`,r.img=s.file.response.data.img,!0}):(s.fileList=s.fileList.filter(r=>r.uid!==s.file.uid),p.error(s.file.response.message))),m(s.fileList),s.file.status==="done"&&s.file.response.code===1&&j(s.fileList)},R=s=>{let r=[...o];return r.map((i,g)=>{if(i.img===s.img)return r.splice(g,1),!1}),m(r),j(r),!1},w=s=>{o.some((r,i)=>{if(r.uid===s.uid)return I(i),!0}),S()},[b,L]=d.useState(0),j=s=>{let r=[];s.map(i=>{i.status==="done"&&r.push(i.img)}),L(r.length),u(r)},E=s=>{if(!(s.type==="image/jpeg"||s.type==="image/png"))return p.error("只能上传图片~"),y.LIST_IGNORE;if(s.size/1024/1024>C.uploadImgMax)return p.error(`图片大小请控制在 ${C.uploadImgMax}M 以内`),y.LIST_IGNORE;if(o.length>=l)return!1},A=B(T(q,{activationConstraint:{distance:5}}),T(J,{coordinateGetter:G})),D=s=>{const{active:r,over:i}=s;if(r.id!==(i==null?void 0:i.id)){let g=(()=>{const U=o.findIndex(h=>h.img===r.id),V=o.findIndex(h=>h.img===(i==null?void 0:i.id));return K(o,U,V)})();m(g),j(g)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{width:"100%",overflow:"hidden"},children:[e.jsx(H,{sensors:A,collisionDetection:Q,onDragEnd:D,children:e.jsx(M,{items:o.map(s=>s.img),strategy:O,modifiers:[re],children:o.map(s=>e.jsx(ie,{data:s,preview:w,remove:R},s.uid))})}),e.jsx("div",{style:{width:"auto",overflow:"hidden",display:b>=l?"none":"inline-block"},children:e.jsx(ee,{rotationSlider:!0,quality:1,fillColor:"rgba(0,0,0,0)",cropShape:"rect",aspect:()=>n/a,beforeCrop:()=>{if(n<=0||a<=0)return!1},children:e.jsx(y,{accept:"image/*",capture:null,name:"img",listType:"picture-card",action:se.uploadUrl,headers:{token:k()},data:{width:n,height:a},onChange:P,fileList:o,maxCount:l,multiple:!(n>0&&a>0),beforeUpload:E,showUploadList:!1,children:e.jsxs("div",{children:[e.jsx(te,{}),e.jsx("div",{className:"ant-upload-text",children:"上传"})]})})})})]}),n>0&&a>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传宽高：",n,"*",a,"的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:n>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传宽为",n,"px的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:a>0?e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["请上传高为",a,"px的图片，最多可上传",l,"张图片，上传后的图片可拖动排序~"]})}):e.jsx(e.Fragment,{children:e.jsxs(f.Text,{type:"secondary",children:["最多可上传",l,"张图片，上传后的图片可拖动排序~"]})})})}),e.jsx("div",{style:{display:"none"},children:e.jsx(F.PreviewGroup,{preview:{visible:c,onVisibleChange:S,current:N,onChange:s=>{I(s)}},children:o.map(s=>s.status==="done"?e.jsx(F,{src:s.url},s.url):"")})})]})};export{Ze as default};
