import{A as N,r as s,j as e,B as y}from"./index-BTXTJVKt.js";import{a as p}from"./adminCodeGenerator-XA6WtBhQ.js";import{C as k}from"./index-BMfK2Dip.js";import{S as z}from"./index-B1B7dhZb.js";import{R as G,C as j}from"./row-DJNm5-9Y.js";import{W as v}from"./index-BMuvgOFD.js";import{P as K}from"./index-CQ-JO01F.js";import{W as i}from"./index-CNcHXf2n.js";import{P as V}from"./index-Cpu1JcVa.js";import{P as J}from"./Table-CUXyCVLs.js";import{A as Q}from"./index-C1Zz-ieJ.js";import{P as U}from"./ProCard-BTx7yLUQ.js";import{F as X}from"./index-BGu4eHBl.js";import{T as C}from"./index-Dx9hPCiE.js";import{P as _}from"./index-D_n6I86r.js";import{I as Z}from"./BaseForm-Bt-x2uS5.js";import{P as ee}from"./index-DWwHrh8G.js";import"./gapSize-U1swVQyS.js";import"./useBreakpoint-C9P5ZgXD.js";import"./index-CsweGtVO.js";import"./index-DWyRM-jO.js";import"./index-CBjIPB84.js";import"./index-DwWsiyHK.js";import"./index-BaexhYUL.js";import"./DownOutlined-dHMiLU6h.js";import"./addEventListener-BQxGY-6f.js";import"./Overflow-DodMVMUF.js";import"./iconUtil-0otcsGdb.js";import"./index-D1w3VCkm.js";import"./PurePanel-BJ0dSvru.js";import"./getAllowClear-SV9Asyat.js";import"./move-BiL2XrK1.js";import"./CheckOutlined-CRheHqkM.js";import"./Input-CJszbmX7.js";import"./index-Ci-Y97rG.js";import"./index-DZ2tAw4A.js";import"./TextArea-Dm9DBQS4.js";import"./LeftOutlined-CNJksXTb.js";import"./index-Wn9_u9d6.js";import"./progress-C-smal5r.js";import"./index-BfhOKpHw.js";import"./index-D5nMW6Hn.js";import"./index-ZV6Sdybn.js";import"./Table-ButWyQXY.js";import"./styleChecker-xca8e-q0.js";import"./index-Clo_9DB7.js";import"./dropdown-ozNz9IXP.js";import"./Dropdown-D-FCcTPI.js";import"./index-D2NRD51k.js";import"./EllipsisOutlined-BzWcE7tF.js";import"./Sider-clMwekzu.js";import"./index-B9ywFgu1.js";import"./HolderOutlined-DO80hp-F.js";import"./CaretDownOutlined-BWLnnrSk.js";import"./index-Dnt0D-Vv.js";import"./index-DiR_3Q38.js";import"./index-Ck2b4VHc.js";import"./index-hKAX5Tgp.js";import"./index-lhHkabfZ.js";import"./index-CcMUfAok.js";import"./index-1Ew_B_KM.js";import"./index-JJDTxIwy.js";import"./index-CHGWkdWj.js";import"./PlusOutlined-DhDAnJdR.js";import"./EditOutlined-Jb-cOsu8.js";import"./CopyOutlined-Bqo58qRo.js";import"./DeleteOutlined-sMe1csST.js";const hl=({tableName:r,operationFile:T,...le})=>{const{message:d}=N.useApp(),F=s.useRef(),n=s.useRef();s.useEffect(()=>{r&&(S(),q(),W(),$())},[r]);const[w,P]=s.useState([]),S=()=>{p.getTableColumn({table_name:r}).then(l=>{l.code===1?P(l.data):d.error(l.message)})},[x,I]=s.useState([]),q=()=>{p.getTableList().then(l=>{l.code===1?I(l.data):d.error(l.message)})},[b,M]=s.useState([]),W=()=>{p.getTableColumnList().then(l=>{l.code===1?M(l.data):d.error(l.message)})},[u,R]=s.useState(null),$=()=>{p.getMysqlConfig().then(l=>{l.code===1?R(l.data):d.error(l.message)})},[c,L]=s.useState({});s.useEffect(()=>{var l;if(b&&c&&u&&n){let t=r.lastIndexOf(u.prefix),a=r.slice(t+u.prefix.length)+"_id",f=((l=c==null?void 0:c.model)==null?void 0:l.relevance)||[];b.map(o=>{if(o.Column.indexOf("_id")!==-1&&o.Table==r){let m=o.Column.lastIndexOf("_id"),h=o.Column.slice(0,m)+o.Column.slice(m+3);h=u.prefix+h,f.find(g=>(g==null?void 0:g.model)==h)||f.push({model:h,type:"belongsTo"})}o.Column==a&&o.Table!=r&&(f.find(m=>(m==null?void 0:m.model)==o.Table)||f.push({model:o.Table}))}),n.current.setFieldValue(["model","relevance"],f)}},[b,c,u,n]);const E=[{value:"json",label:"自动转json"},{value:"integer",label:"整型"},{value:"float",label:"浮点型"},{value:"boolean",label:"布尔型"},{value:"array",label:"自动转json"},{value:"timestamp:Y-m-d",label:"时间戳/读的时候Y-m-d"},{value:"timestamp:Y-m-d H:i",label:"时间戳/读的时候Y-m-d H:i"},{value:"timestamp:Y-m-d H:i:s",label:"时间戳/读的时候Y-m-d H:i:s"}],A=[{value:"",label:"等于附件路劲"},{value:"array",label:"数组中包含附件"},{value:"editor",label:"富文本中包含附件"}],B=[{value:"",label:"空函数"},{value:"=",label:"等于"},{value:"like",label:"模糊搜索"},{value:"BETWEEN_TIME",label:"日期范围"},{value:"<>",label:"不等于"},{value:">",label:"大于"},{value:"<",label:"小于"},{value:">=",label:"大于等于"},{value:"<=",label:"小于等于"},{value:"in",label:"in搜索"},{value:"not in",label:"not in"},{value:"between",label:"between"}],D=[{value:"",label:"空函数"}],Y=[{value:"",label:"空函数"}],H=[{value:"hasOne",label:"一对一|如用户有一个资料表"},{value:"belongsTo",label:"反向一对一|如我属于某个角色"},{value:"hasMany",label:"一对多|如文章的评论"},{value:"belongsToMany",label:"多对多"}],O=[{title:"字段",width:200,dataIndex:"Field"},{title:"类型",width:120,dataIndex:"Type"},{title:"允许为空",dataIndex:"Null",width:80,render:(l,t)=>t.Null=="NO"?e.jsx(C.Text,{type:"danger",children:"否"}):e.jsx(C.Text,{type:"success",children:"是"})},{title:"默认值",dataIndex:"Default",width:70,render:(l,t)=>t.Default?t.Default:t.Default===null?"null":""},{title:"注释",dataIndex:"Comment",ellipsis:!0},{title:"字段名称",dataIndex:"field_title"},{title:"字段类型",dataIndex:"field_type",render:(l,t)=>e.jsx(e.Fragment,{children:e.jsx(i,{name:["model","type",`${t.Field}`],placeholder:"请选择",request:async()=>E,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,optionRender:a=>`${a.data.label}（${a.data.value}）`}})})},{title:"包含附件",dataIndex:"field_file",render:(l,t)=>e.jsx(e.Fragment,{children:e.jsx(i,{name:["model","file",`${t.Field}`],placeholder:"请选择",request:async()=>A,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,optionRender:a=>`${a.data.label}（${a.data.value}）`}})})},{title:"搜索器",dataIndex:"field_search_attr",render:(l,t)=>e.jsx(e.Fragment,{children:e.jsx(i,{name:["model","search",`${t.Field}`],placeholder:"请选择",request:async()=>B,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,optionRender:a=>`${a.data.label}（${a.data.value}）`}})})},{title:"修改器",dataIndex:"field_set_attr",render:(l,t)=>e.jsx(e.Fragment,{children:e.jsx(i,{name:["model","set",`${t.Field}`],placeholder:"请选择",request:async()=>D,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0}})})},{title:"获取器",dataIndex:"field_get_attr",render:(l,t)=>e.jsx(e.Fragment,{children:e.jsx(i,{name:["model","get",`${t.Field}`],placeholder:"请选择",request:async()=>Y,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0}})})}];return e.jsxs(e.Fragment,{children:[e.jsx(_,{formRef:n,size:"small",params:{table_name:r},request:async l=>{const t=await p.getCodeGeneratorInfo(l);return L(t.data),t.data||{}},submitter:!1,onFinish:async l=>{p.generatorCode({model:{...l.model,file_suffix:"php"},table_name:r,code_name:"model"}).then(t=>{t.code===1?(d.success(t.message),n.current.setFieldValue("model_code",t.data.model_code)):d.error(t.message)})},children:e.jsxs(z,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(G,{gutter:[24,0],children:[e.jsx(j,{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6,children:e.jsx(v,{name:["model","file_name"],label:"模型类名",placeholder:"请输入",rules:[{required:!0,message:"请输入"}]})}),e.jsx(j,{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6,children:e.jsx(v,{name:["model","file_path"],label:"命名空间",placeholder:"请输入",extra:"模型路劲，同时也是命名空间",rules:[{required:!0,message:"请输入"}]})}),e.jsx(j,{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6,children:e.jsx(K,{name:["model","is_middle"],label:"是否是多对多中间表"})})]}),e.jsx(Z,{name:["model","relevance"],label:"关联模型",creatorButtonProps:{creatorButtonText:"添加关联模型"},extra:"最自动找出所有的关联，需手动绑定关系，多对多则需手动添加关联模型",children:e.jsxs(ee,{children:[e.jsx(v,{name:"title",label:"描述",placeholder:"请输入",rules:[{required:!0,message:"请输入"}],fieldProps:{style:{width:180}}}),e.jsx(i,{name:"type",label:"关系",placeholder:"请选择",options:H,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,style:{width:200}},rules:[{required:!0,message:"请选择"}]}),e.jsx(i,{name:"model",label:"关联模型",placeholder:"请选择",options:x,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,showSearch:!0,fieldNames:{value:"Name",label:"Name"},style:{width:180}},rules:[{required:!0,message:"请选择"}]}),e.jsx(V,{name:["type"],ignoreFormListField:!1,children:({type:l})=>e.jsx(i,{name:"middle",label:"中间表",placeholder:"请选择",disabled:l!="belongsToMany",options:x,fieldProps:{popupMatchSelectWidth:!1,allowClear:!0,options:x,fieldNames:{value:"Name",label:"Name"},style:{width:180}},rules:[{required:l=="belongsToMany",message:"请选择"}]})})]})}),e.jsx(J,{className:"generator-model",actionRef:F,rowKey:"Field",columns:O,pagination:!1,options:!1,search:!1,bordered:!0,size:"small",dataSource:w}),e.jsx(_.Item,{name:"model_code",children:e.jsx(k,{language:"php"})})]})}),e.jsx(Q,{offsetBottom:10,children:e.jsx(U,{boxShadow:!0,children:e.jsxs(X,{align:"center",justify:"center",gap:"small",children:[e.jsx(y,{type:"primary",size:"default",onClick:()=>{n.current.submit()},children:"保存设置》生成预览代码"}),e.jsx(y,{danger:!0,onClick:()=>{T("model")},children:"生成到项目"})]})})})]})};export{hl as default};
