import{r as d,A as q,u as G,m as H,j as n,B as _}from"./index-ZI51y314.js";import{a as J}from"./adminMenu-uwbNihI8.js";import{a as K}from"./adminRole-DS698sV_.js";import{u as Q}from"./index-D-YlH6e-.js";import{D as V}from"./index-DWBnXa5p.js";import{S as C}from"./index-DFWIh5En.js";import{I as W}from"./index-CzgBx6dd.js";import{T as X}from"./index-BWfJjs86.js";import"./gapSize-U1swVQyS.js";import"./getAllowClear-Bb8ihI2F.js";import"./Input-YyHXjDeB.js";import"./TextArea-CbhGwHw0.js";import"./index-BIgUuT9u.js";import"./iconUtil-snskxn8a.js";import"./index-C4Es4GTO.js";import"./HolderOutlined-51iibq6a.js";const k=(r,c)=>{let u;for(let l=0;l<c.length;l++){const o=c[l];o.children&&(o.children.some(g=>g.id===r)?u=o.id:k(r,o.children)&&(u=k(r,o.children)))}return u},he=r=>{d.useRef();const{message:c}=q.useApp(),[u,l]=d.useState(!1);G(()=>{$()}),Q(()=>{r.roleId>0&&(l(!0),K.getDataMenu({id:r.roleId}).then(e=>{e.code===1?j(e.data.AdminRoleMenu.map(t=>t.admin_menu_id)):c.error(e.message)}))},[r.roleId]);const o=(e,t)=>(e.indexOf(t)===-1&&e.push(t),e),g=(e,t)=>{let a=e.indexOf(t);return a!==-1&&e.splice(a,1),e},E=(e,{checked:t,node:a})=>{let s=[...y],p=f.filter(i=>i.pid_name_path.indexOf(`,${a.name},`)!==-1&&i.id!==a.id);p.push(a),t===!0&&p.map(i=>{s=o(s,i.id)}),t===!1&&p.map(i=>{s=g(s,i.id)});for(let i=a.pid_name_path.length-1;i>=0;i--){let h=a.pid_name_path[i];if(h===a.name)continue;s.some(x=>{let L=f.find(O=>O.id===x&&O.name!=h);return L?L.pid_name_path.indexOf(`,${h},`)!==-1:!1})===!0?s=o(s,f.find(x=>x.name==h).id):s=g(s,f.find(x=>x.name==h).id)}j(s)},M=()=>{j(y.length===0?F:[])},[D,S]=d.useState([]),[m,b]=d.useState(""),[w,R]=d.useState(!0),v=e=>{if(b(e.target.value),!e.target.value)return S([]),!1;const t=f.map(a=>a.title.indexOf(e.target.value)>-1?k(a.id,I):null).filter((a,s,p)=>a&&p.indexOf(a)===s);S(t),R(!0)},T=e=>{S(e),R(!1)},[I,P]=d.useState([]),[f,B]=d.useState([]),[F,N]=d.useState([]),$=()=>{J.getList().then(e=>{e.code===1&&(B(e.data),N(e.data.map(t=>t.id)),P(H(e.data)))})},[y,j]=d.useState([]),[z,A]=d.useState(!1),U=()=>{A(!0),K.updateDataMenu({id:r.roleId,admin_menu_id:y}).then(e=>{e.code===1?(c.success(e.message),r.tableReload(),r.setRoleId(0),l(!1)):c.error(e.message),A(!1)}).catch(e=>{A(!1)})};return n.jsx(V,{title:"权限设置",placement:"right",onClose:()=>{l(!1),r.setRoleId(0)},open:u,extra:n.jsxs(C,{children:[n.jsx(_,{onClick:M,children:"全选"}),n.jsx(_,{type:"primary",onClick:U,loading:z,children:"保存"})]}),children:n.jsxs(C,{direction:"vertical",style:{width:"100%"},size:"large",children:[n.jsx(W.Search,{onChange:v,placeholder:"搜索..."}),n.jsx(X,{checkable:!0,blockNode:!0,defaultExpandAll:!0,checkStrictly:!0,treeData:I,fieldNames:{key:"id"},autoExpandParent:w,checkedKeys:y,expandedKeys:D,onExpand:T,onCheck:E,titleRender:({title:e,id:t})=>e.indexOf(m)>-1?n.jsxs(n.Fragment,{children:[n.jsx("span",{children:e.substr(0,e.indexOf(m))}),n.jsx("span",{style:{color:"red"},children:m}),n.jsx("span",{children:e.substr(e.indexOf(m)+m.length)})]}):n.jsxs("span",{children:[e,"[",t,"]"]})})]})})};export{he as default};
