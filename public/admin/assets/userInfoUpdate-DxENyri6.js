import{r as i,I as w,d as S,R as T,z as M,A as O,j as e,dj as $,aK as k,b as A,c as f}from"./index-ZI51y314.js";import{u as C}from"./index-CvdnMNBF.js";import{f as F}from"./file-lMMXiPj9.js";import{I as L}from"./antd-img-crop.esm-u9quxmEX.js";import{F as n}from"./index-DPgpDBVC.js";import{R as g}from"./UserOutlined-DADFtDaa.js";import{M as U}from"./index-rQeGZp6R.js";import{U as z}from"./index-B-1LKTLM.js";import{R as _}from"./PlusOutlined-BrSmXzHo.js";import{I as q}from"./index-CzgBx6dd.js";import{T as E}from"./progress-DyKaNkG9.js";import"./row-CA0HzO8K.js";import"./useBreakpoint-LlaO7o8U.js";import"./index-BIgUuT9u.js";import"./PurePanel-IzJJVpwi.js";import"./DeleteOutlined-BJQ6Ec5G.js";import"./getAllowClear-Bb8ihI2F.js";import"./Input-YyHXjDeB.js";import"./TextArea-CbhGwHw0.js";import"./DownOutlined-BvFNYu2h.js";import"./CheckOutlined-BH5QPYjn.js";var P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M800 64H224c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h576c35.3 0 64-28.7 64-64V128c0-35.3-28.7-64-64-64zm-8 824H232V136h560v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"tablet",theme:"outlined"},V=function(s,a){return i.createElement(w,S({},s,{ref:a,icon:P}))},B=i.forwardRef(V);const pe=()=>{const[d,{toggle:s}]=C(),[a,h]=T(M),[x,c]=i.useState(!1),[j,l]=i.useState(!1),[u]=n.useForm(),{message:r}=O.useApp(),[o,I]=i.useState({img:a==null?void 0:a.img,name:a==null?void 0:a.name,tel:a==null?void 0:a.tel}),b=()=>{u.validateFields().then(t=>{c(!0);const m={...t,img:o.img};A.updateInfo(m).then(p=>{p.code===1?(r.success(p.message),h(R=>({...R,...m})),s()):r.error(p.message),c(!1)})}).catch(t=>{})},v=t=>{if(!(t.type==="image/jpeg"||t.type==="image/png"))return r.error("只能上传图片~"),!1;if(t.size/1024/1024>f.uploadImgMax)return r.error(`图片大小请控制在 ${f.uploadImgMax}M 以内`),!1},y=t=>{if(t.file.status==="uploading"){l(!0);return}if(t.file.status==="error"){r.error("上传出错~"),l(!1);return}if(t.file.status==="done"){t.file.response.code===1?I({...o,img:t.file.response.data.avatar}):r.error("上传出错~"),l(!1);return}};return e.jsxs(e.Fragment,{children:[e.jsxs("span",{onClick:s,children:[e.jsx(g,{})," 修改资料"]}),e.jsx(U,{open:d,title:"修改资料",onCancel:s,confirmLoading:x,onOk:b,width:400,children:e.jsxs(n,{form:u,layout:"vertical",name:"userInfoUpdate",initialValues:o,children:[e.jsx("div",{style:{width:"100px",margin:"0px auto"},children:e.jsx(L,{rotationSlider:!0,quality:1,cropShape:"round",aspect:200/200,modalProps:{keyboard:!0,maskClosable:!0},children:e.jsx(z,{name:"avatar",accept:"image/*",listType:"picture-circle",showUploadList:!1,beforeUpload:v,onChange:y,action:F.uploadUrl,headers:{token:$()},data:{width:200,height:200},children:o.img?e.jsx("img",{src:`${o.img}`,alt:"avatar",style:{width:"100%",borderRadius:"1000px"}}):e.jsxs("div",{children:[j?e.jsx(k,{}):e.jsx(_,{}),e.jsx("div",{style:{marginTop:8},children:"上传头像"})]})})})}),e.jsx(n.Item,{name:"name",label:"姓名",rules:[{required:!0,message:"请输入姓名~"}],children:e.jsx(q,{prefix:e.jsx(g,{}),placeholder:"请输入"})}),e.jsx(n.Item,{name:"tel",label:"手机号",rules:[{required:!0,message:"请输入手机号~"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}],children:e.jsx(E,{prefix:e.jsx(B,{}),style:{width:"100%"},placeholder:"请输入"})})]})})]})};export{pe as default};
