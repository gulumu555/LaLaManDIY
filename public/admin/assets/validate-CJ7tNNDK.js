import{A as S,r as o,j as e,B as j}from"./index-BTXTJVKt.js";import{a as h}from"./adminCodeGenerator-XA6WtBhQ.js";import{C as $}from"./index-BMfK2Dip.js";import{S as R}from"./index-B1B7dhZb.js";import{R as W,C as y}from"./row-DJNm5-9Y.js";import{W as u}from"./index-BMuvgOFD.js";import{A as B}from"./index-C1LhiznF.js";import{D as E}from"./index-Dwni2OoB.js";import{I as G}from"./BaseForm-Bt-x2uS5.js";import{P as U}from"./index-DWwHrh8G.js";import{P as F}from"./index-Cpu1JcVa.js";import{W as w}from"./index-CNcHXf2n.js";import{A as k}from"./index-C1Zz-ieJ.js";import{P as z}from"./ProCard-BTx7yLUQ.js";import{F as L}from"./index-BGu4eHBl.js";import{T as I}from"./index-Dx9hPCiE.js";import{T as M}from"./index-DWyRM-jO.js";import{R as K}from"./index-CsweGtVO.js";import{P as C}from"./index-D_n6I86r.js";import"./gapSize-U1swVQyS.js";import"./useBreakpoint-C9P5ZgXD.js";import"./index-CBjIPB84.js";import"./Table-CUXyCVLs.js";import"./index-ZV6Sdybn.js";import"./index-DwWsiyHK.js";import"./index-BaexhYUL.js";import"./DownOutlined-dHMiLU6h.js";import"./Table-ButWyQXY.js";import"./styleChecker-xca8e-q0.js";import"./addEventListener-BQxGY-6f.js";import"./Overflow-DodMVMUF.js";import"./iconUtil-0otcsGdb.js";import"./index-D1w3VCkm.js";import"./PurePanel-BJ0dSvru.js";import"./getAllowClear-SV9Asyat.js";import"./move-BiL2XrK1.js";import"./CheckOutlined-CRheHqkM.js";import"./Input-CJszbmX7.js";import"./index-Ci-Y97rG.js";import"./index-Clo_9DB7.js";import"./dropdown-ozNz9IXP.js";import"./LeftOutlined-CNJksXTb.js";import"./Dropdown-D-FCcTPI.js";import"./index-D2NRD51k.js";import"./EllipsisOutlined-BzWcE7tF.js";import"./Sider-clMwekzu.js";import"./index-B9ywFgu1.js";import"./HolderOutlined-DO80hp-F.js";import"./CaretDownOutlined-BWLnnrSk.js";import"./index-Dnt0D-Vv.js";import"./index-DiR_3Q38.js";import"./index-Ck2b4VHc.js";import"./index-hKAX5Tgp.js";import"./index-lhHkabfZ.js";import"./index-CcMUfAok.js";import"./index-1Ew_B_KM.js";import"./index-JJDTxIwy.js";import"./progress-C-smal5r.js";import"./index-Wn9_u9d6.js";import"./index-DZ2tAw4A.js";import"./TextArea-Dm9DBQS4.js";import"./index-CHGWkdWj.js";import"./PlusOutlined-DhDAnJdR.js";import"./core.esm-Ds3LvBvm.js";import"./CopyOutlined-Bqo58qRo.js";import"./DeleteOutlined-sMe1csST.js";import"./index-BfhOKpHw.js";import"./index-D5nMW6Hn.js";import"./EditOutlined-Jb-cOsu8.js";const ma=({tableName:n,operationFile:P,...H})=>{const{message:c}=S.useApp(),g=o.useRef();o.useEffect(()=>{n&&q()},[n]);const[f,x]=o.useState([]),[A,v]=o.useState(),q=()=>{h.getTableColumn({table_name:n}).then(l=>{l.code===1?(x(l.data),v(Date.now())):c.error(l.message)})};o.useEffect(()=>{var l;if(t&&f.length>0){const a=[];for(let r in(l=t==null?void 0:t.validate)==null?void 0:l.field_rules)f.some(s=>{var m;if(s.Field==r&&((m=t==null?void 0:t.validate)==null?void 0:m.field_rules[r].length)>0)return a.push(s),!0});f.map(r=>{var s,m,d,i;(!((m=(s=t==null?void 0:t.validate)==null?void 0:s.field_rules)!=null&&m[r.Field])||((i=(d=t==null?void 0:t.validate)==null?void 0:d.field_rules)==null?void 0:i[r.Field].length)==0)&&a.push(r)}),x(a)}},[A]);const[t,T]=o.useState({}),_=[{value:"require",label:"必填",message:"请输入{file_name}",params:!1,tip:""},{value:"in",label:"在某个范围",message:"请选择正确的{file_name}",params:!0,tip:"如：1,2,3"},{value:"confirm",label:"与某个字段值相等",message:"{file_name}必须与：",params:!0,tip:"如：password"},{value:"unique",label:"字段的值唯一",message:"{file_name}已存在",params:!0,tip:"如：AdminUser，代表AdminUser表唯一"},{value:"mobile",label:"有效的手机",message:"请输入正确的{file_name}",params:!1,tip:""},{value:"idCard",label:"身份证",message:"请输入正确的身份证号",params:!1,tip:""},{value:"url",label:"URL地址",message:"{file_name}只能是有效的URL地址",params:!1,tip:""},{value:"between",label:"某个区间",message:"{file_name}只能是：",params:!0,tip:"如：1,10"},{value:"max",label:"最大长度",message:"{file_name}最大长度为：",params:!0,tip:"如：10"},{value:"min",label:"最小长度",message:"{file_name}最小长度为：",params:!0,tip:"如：10"},{value:"length",label:"长度",message:"{file_name}长度必须是：",params:!0,tip:"如：1,10；代表1到10位，如：4；代表长度位4"},{value:"egt",label:"大于等于",message:"{file_name}必须大于等于",params:!0,tip:"如：100"},{value:"elt",label:"小于等于",message:"{file_name}必须小于等于",params:!0,tip:"如：100"},{value:"number",label:"数字",message:"{file_name}必须是数字",params:!1,tip:""},{value:"integer",label:"整数",message:"{file_name}必须是整数",params:!1,tip:""},{value:"float",label:"浮点数",message:"{file_name}必须是浮点数",params:!1,tip:""},{value:"boolean",label:"布尔值",message:"请选择{file_name}",params:!1,tip:""},{value:"email",label:"邮箱",message:"请填写正确的邮箱",params:!1,tip:""},{value:"array",label:"数组",message:"请选择{file_name}",params:!1,tip:""},{value:"date",label:"有效日期",message:"{file_name}请选择正确的日期",params:!1,tip:""},{value:"alpha",label:"纯字母",message:"{file_name}必须是字母",params:!1,tip:""},{value:"alphaNum",label:"字母和数字",message:"{file_name}必须是字母和数字",params:!1,tip:""},{value:"lower",label:"小写字符",message:"{file_name}只能是小写字符",params:!1,tip:""},{value:"upper",label:"大写字符",message:"{file_name}只能是大写字符",params:!1,tip:""},{value:"xdigit",label:"十六进制字符串",message:"{file_name}只能是十六进制字符串",params:!1,tip:""},{value:"activeUrl",label:"有效的域名或者IP",message:"{file_name}只能是有效的域名或者IP",params:!1,tip:""},{value:"ip",label:"IP地址",message:"{file_name}只能是有效的IP地址",params:!1,tip:""},{value:"macAddr",label:"MAC地址",message:"MAC地址格式错误",params:!1,tip:""},{value:"zip",label:"邮政编码",message:"邮政编码格式错误",params:!1,tip:""},{value:"notIn",label:"不在某个范围",message:"{file_name}不能选择：",params:!0,tip:"如：1,2,3"},{value:"notBetween",label:"不在某个区间",message:"{file_name}不能是：",params:!0,tip:"如：1,10"},{value:"after",label:"某个日期之后",message:"{file_name}必须大于：",params:!0,tip:"如：2016-3-18"},{value:"before",label:"某个日期之前",message:"{file_name}必须小于：",params:!0,tip:"如：2016-3-18"},{value:"expire",label:"日期之间",message:"{file_name}必须在：",params:!0,tip:"如：2016-2-1,2016-10-01"},{value:"different",label:"与某个字段值不相等",message:"{file_name}必须与：",params:!0,tip:"如：password"},{value:"eq",label:"等于",message:"{file_name}必须等于",params:!0,tip:"如：100"},{value:"lt",label:"小于",message:"{file_name}必须小于",params:!0,tip:"如：100"},{value:"requireIf",label:"当某字段等于xx的时候必须",message:"请输入{file_name}",params:!0,tip:"如：account,1；代表account等于1的时候必须"},{value:"requireWith",label:"当某字段有值的时候必须",message:"请输入{file_name}",params:!0,tip:"如：account；代表account字段有值的是必填"},{value:"requireWithout",label:"当某字段没有值的时候必须",message:"{file_name}必须为空",params:!0,tip:"如：account；代表account字段没有值的是必填"}],D=[{title:"排序",dataIndex:"sort",width:50},{title:"字段",width:200,dataIndex:"Field"},{title:"类型",width:120,dataIndex:"Type"},{title:"允许为空",dataIndex:"Null",width:80,render:(l,a)=>a.Null=="NO"?e.jsx(I.Text,{type:"danger",children:"否"}):e.jsx(I.Text,{type:"success",children:"是"})},{title:"默认值",dataIndex:"Default",width:70,render:(l,a)=>a.Default?a.Default:a.Default===null?"null":""},{title:"注释",dataIndex:"Comment",ellipsis:!0},{title:"字段名称",dataIndex:"field_title"},{title:"验证规则",dataIndex:"rule",render:(l,a)=>e.jsx(e.Fragment,{children:e.jsx(w,{name:["validate","field_rules",`${a.Field}`],placeholder:"请选择",request:async()=>_,fieldProps:{popupMatchSelectWidth:!1,mode:"multiple",allowClear:!0,optionRender:r=>`${r.data.label}（${r.data.value}）`}})})},{title:"验证详情",dataIndex:"rule_info",render:(l,a)=>e.jsx(e.Fragment,{children:e.jsx(F,{name:[["validate","field_rules",a.Field]],children:({validate:r})=>{var s,m;if(Array.isArray((s=r==null?void 0:r.field_rules)==null?void 0:s[a.Field]))return(m=r==null?void 0:r.field_rules)==null?void 0:m[a.Field].map(i=>{let p=_.find(b=>b.value==i);return e.jsx(u,{name:["validate","field_rules_info",`${a.Field}`,`${i}`],placeholder:"详细规则...",fieldProps:{addonBefore:i,disabled:!p.params,style:{margin:"2px 0px"},addonAfter:e.jsx(M,{title:`${p.label}${p.tip?" "+p.tip:""}`,children:e.jsx(K,{})})},rules:[{required:p.params,message:"请输入"}]},i)})}})})}];return e.jsxs(e.Fragment,{children:[e.jsx(C,{formRef:g,size:"small",params:{table_name:n},request:async l=>{const a=await h.getCodeGeneratorInfo(l);return T(a.data),v(Date.now()),a.data||{}},submitter:!1,onFinish:async l=>{h.generatorCode({validate:{...l.validate,file_suffix:"php"},table_name:n,code_name:"validate"}).then(a=>{a.code===1?(c.success(a.message),g.current.setFieldValue("validate_code",a.data.validate_code)):c.error(a.message)})},children:e.jsxs(R,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(W,{gutter:[24,0],children:[e.jsx(y,{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6,children:e.jsx(u,{name:["validate","file_name"],label:"验证器类名",placeholder:"请输入",rules:[{required:!0,message:"请输入"}]})}),e.jsx(y,{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6,children:e.jsx(u,{name:["validate","file_path"],label:"命名空间",placeholder:"请输入",extra:"验证器路劲，同时也是命名空间",rules:[{required:!0,message:"请输入"}]})})]}),e.jsx(B,{message:e.jsxs(e.Fragment,{children:["如果需要验证场景，建议将所有的字段验证规则都设置起，然后在分别添加验证场景，",e.jsx("b",{children:"这样在添加验证场景的时候就只会有删除某个字段的规则而不会出现添加某个字段的规则"})]}),type:"warning",showIcon:!0}),e.jsx(E,{className:"generator-validate",ghost:!0,rowKey:"Field",search:!1,pagination:!1,options:!1,bordered:!0,dragSortKey:"sort",columns:D,size:"small",onDragSortEnd:(l,a,r)=>{x(r)},dataSource:f}),e.jsx(G,{name:["validate","scenes"],label:"验证场景（逻辑层会自动判断是否有create、update这两个验证场景并自动加上）",creatorButtonProps:{creatorButtonText:"添加验证场景"},children:e.jsxs(U,{children:[e.jsx(u,{name:"name",label:"场景名称（英文且唯一）",rules:[{required:!0,message:"请输入"}],fieldProps:{style:{width:180}}}),e.jsx(u,{name:"desc",label:"场景描述（如修改）",rules:[{required:!0,message:"请输入"}],fieldProps:{style:{width:180}}}),e.jsx(F,{name:[["validate","field_rules"]],ignoreFormListField:!0,children:({validate:l})=>{var r;let a=[];for(let s in l==null?void 0:l.field_rules){let m=((r=t.field_title)==null?void 0:r[s])||s;(l==null?void 0:l.field_rules[s].map(i=>{let p=_.find(b=>b.value==i);return{rule_name:i,label:p.label}})).map(i=>{a.push({value:`${s}|${i.rule_name}`,label:`${m}：${i.label}`})})}return e.jsx(w,{name:"delete_rules",label:"要删除的规则",placeholder:"请选择",params:{validate:l},request:async()=>a,fieldProps:{popupMatchSelectWidth:!1,mode:"multiple",allowClear:!0,style:{width:180}},rules:[]})}})]})}),e.jsx(C.Item,{name:"validate_code",children:e.jsx($,{language:"php"})})]})}),e.jsx(k,{offsetBottom:10,children:e.jsx(z,{boxShadow:!0,children:e.jsxs(L,{align:"center",justify:"center",gap:"small",children:[e.jsx(j,{type:"primary",size:"default",onClick:()=>{g.current.submit()},children:"保存设置》生成预览代码"}),e.jsx(j,{danger:!0,onClick:()=>{P("validate")},children:"生成到项目"})]})})})]})};export{ma as default};
